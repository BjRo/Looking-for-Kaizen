
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Testing F# code with xUnit.net (on .NET 4.0) - Dude, where's my Kaizen?</title>
  <meta name="author" content="Björn Rochel">

  
  <meta name="description" content="A lot of my free time currently goes into learning F#.While I had a great time playing around with the F# REPL FSI, I came to the conclusion that &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.bjoernrochel.de/2010/04/19/testing-f-code-with-xunit-net-on-net-4-0/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Dude, where's my Kaizen?" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <header role="banner"><div id="logo">
	<img src="/images/kaizen.png" alt="Kaizen" title="Kaizen" />
</div>
<hgroup>
  <h1><a href="/">Dude, where's my Kaizen?</a></h1>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.bjoernrochel.de" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Testing F# Code With xUnit.net (on .NET 4.0)</h1>
    
    
      <p class="meta">
        





  



<time datetime="2010-04-19T08:48:46+02:00" pubdate  data-updated="true" >Apr 19<span>th</span>, 2010</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>A lot of my free time currently goes into learning F#.
While I had a great time playing around with the F# REPL FSI, I came to the conclusion that using FSI is not my
preferred way of a) learning the F# language and b) to develop code.
Writing unit tests simply for the purpose of learning and understanding of a language/component/system (aka &quot;Learning tests&quot;) seems to be a better fit,
at least for me. So, I sat down in order to see how I can use my beloved xUnit.net for this.
As it turns out it&#8217;s not that difficult, but it&#8217;s got some hurdles.</p>

<!--more-->


<h2>Possible runtime differences</h2>

<p>xUnit.net 1.5 is compiled against the .Net Framework 3.5. If you&#8217;re using F# in combination with the VS2010 RC or
RTM (like I do) you&#8217;ve got at least to options to make them work together.</p>

<ul>
<li>Use multi-targeting and configure the F# projects to compile for the .NET 3.5 runtime  (<code>Properties/Application/Target Framework</code>).</li>
<li>Update the app.config files of xunit.console.exe and xunit.gui.exe with a startup section and specify the .NET framework 4.0 version as supported.</li>
</ul>


<figure class='code'><figcaption><span>Update the app config</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'> <span class="nt">&lt;startup&gt;</span>
</span><span class='line'>  <span class="nt">&lt;supportedRuntime</span> <span class="na">version=</span><span class="s">&quot;v4.0.30128&quot;</span> <span class="na">safemode=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- VS2010 RC --&gt;</span>
</span><span class='line'>  <span class="nt">&lt;supportedRuntime</span> <span class="na">version=</span><span class="s">&quot;v4.0.30319&quot;</span> <span class="na">safemode=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span> <span class="c">&lt;!-- VS2010 RTM --&gt;</span>
</span><span class='line'> <span class="nt">&lt;/startup&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Pay attention to your parentheses</h2>

<p>My choice was to update the xUnit.net configurations. After the update of the configuration files my assembly was loaded,
however the test runner failed to detect my unit tests. As it turns out the open parentheses after a test function play an important role.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na"> [&lt;Fact&gt;]</span>
</span><span class='line'> <span class="n">let</span> <span class="n">After_converting_a_valid_data_row_the_title_should_have_been_extracted</span> <span class="p">=</span> <span class="c1">//This compiles, but the test doesn&#39;t show up in the test runner.</span>
</span><span class='line'>    <span class="n">let</span> <span class="n">row</span> <span class="p">=</span> <span class="n">convertDataRow</span> <span class="s">&quot;Test, 1234&quot;</span>
</span><span class='line'>    <span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">fst</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="s">&quot;Test&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="na"> [&lt;Fact&gt;]</span>
</span><span class='line'> <span class="n">let</span> <span class="nf">After_converting_a_valid_data_row_the_title_should_have_been_extracted</span><span class="p">()</span> <span class="p">=</span> <span class="c1">//This will work fine</span>
</span><span class='line'>    <span class="n">let</span> <span class="n">row</span> <span class="p">=</span> <span class="n">convertDataRow</span> <span class="s">&quot;Test, 1234&quot;</span>
</span><span class='line'>    <span class="n">Assert</span><span class="p">.</span><span class="n">Equal</span><span class="p">(</span><span class="n">fst</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="s">&quot;Test&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>My first reaction was: WTF? But after reading some more chapters of &quot;Real world functional programming&quot; and a discussion at our
local F# book club the behavior makes sense to me. My current understanding is that omitting the parentheses results in a different method signature.
You can easily spot this in FSI:</p>

<ul>
<li>The first one is <code>val After_converting_a_valid_data_row_the_title_should_have_been_extracted : unit</code></li>
<li>The second one results in a <code>val After_converting_a_valid_data_row_the_title_should_have_been_extracted : unit -&gt; unit</code></li>
</ul>


<p>What you can see here is that the first function signature doesn&#8217;t have a parameter while the second has a parameter of the type <code>unit</code>.
One interesting difference between F# and C# is that the F# equivalent to C#&#8217;s <code>void</code> is an actual type called <code>unit</code>.
The fun part is that <code>()</code> is it&#8217;s only value. Parentheses play a completely different role here ;-)</p>

<p>The xUnit test runner looks for methods with one unit parameter and a return type of unit.
That&#8217;s why you need the parentheses.</p>

<h2>Testing exceptions with xUnit.Net</h2>

<p>One little subtlety I came across when testing exceptions is that you have to explicitly ignore the return value
when you&#8217;re using Assert.Throws and pass in a method which doesn&#8217;t return unit. Feels a bit strange at first, but explainable.
Again a signature mismatch. <code>Assert.Throws</code> expects a method with a <code>unit -&gt; unit</code> signature.
You have to do this in order to please the compiler. (If there&#8217;s a better way for this, please let me know)</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[&lt;Fact&gt;]</span>
</span><span class='line'><span class="n">let</span> <span class="nf">Trying_to_convert_an_invalid_format_throws</span><span class="p">()</span> <span class="p">=</span>
</span><span class='line'>    <span class="n">Assert</span><span class="p">.</span><span class="n">Throws</span><span class="p">(</span><span class="n">fun</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="n">convertDataRow</span> <span class="s">&quot;FuBar&quot;</span> <span class="p">|&gt;</span> <span class="n">ignore</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>The ignore function simply throws away any value it receives, returns a unit and makes the F# compiler happy.</p>

<h2>Conclusion</h2>

<p>I hope you saw in this post that testing F# with xUnit.net is actually pretty easy.
It&#8217;s also a wonderful case for language interop on top of the CLR. Go see it for yourself :-)</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">BjRo</span></span>

      





  



<time datetime="2010-04-19T08:48:46+02:00" pubdate  data-updated="true" >Apr 19<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/fsharp/'>FSharp</a>, <a class='category' href='/blog/categories/dotnet/'>dotnet</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.bjoernrochel.de/2010/04/19/testing-f-code-with-xunit-net-on-net-4-0/" data-via="bjoernrochel" data-counturl="http://www.bjoernrochel.de/2010/04/19/testing-f-code-with-xunit-net-on-net-4-0/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
</div>

    
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
	<h1>About me</h1>
  <p><br/><img src="/images/bjro-eyes.jpg" alt="portrait" /></p>
	<p>
  My name is <strong>Björn Rochel</strong>.  I'm a 32 year old geek, who's crazy about software development, living in Cologne and
  currently working for <a href="http://www.intercomponentware.com">ICW</a> as a .NET Developer / Architect.
	</p>
	<ul class="badges">
		<li><a href="http://www.xing.com/profile/Bjoern_Rochel"><img src="/images/badges/xing2-small.png" alt="Xing" /></a></li>
		<li><a href="http://www.github.com/BjRo"><img src="/images/badges/github-small.png" alt="Github" /></a></li>
		<li><a href="http://www.twitter.com/bjoernrochel"><img src="/images/badges/twitter-square-small.png" alt="Twitter" /></a></li>
		<li><a href="/atom.xml"><img src="/images/badges/rss-circle-small.png" alt="Rss" /></a></li>
	</ul>
</section>

<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/Conferences/'>Conferences (8)</a></li>
<li class='category'><a href='/blog/categories/FSharp/'>FSharp (3)</a></li>
<li class='category'><a href='/blog/categories/Katas/'>Katas (2)</a></li>
<li class='category'><a href='/blog/categories/StoryTeller/'>StoryTeller (14)</a></li>
<li class='category'><a href='/blog/categories/StructureMap/'>StructureMap (9)</a></li>
<li class='category'><a href='/blog/categories/Testing/'>Testing (20)</a></li>
<li class='category'><a href='/blog/categories/Uncategorized/'>Uncategorized (8)</a></li>
<li class='category'><a href='/blog/categories/dotnet/'>dotnet (65)</a></li>
<li class='category'><a href='/blog/categories/ruby/'>ruby (3)</a></li>
<li class='category'><a href='/blog/categories/sw-design/'>sw-design (13)</a></li>
<li class='category'><a href='/blog/categories/xUnitBDDExtensions/'>xUnitBDDExtensions (15)</a></li>

  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("bjoernrochel", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/bjoernrochel" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @bjoernrochel</a>
  
</section>

<section>
<h1>Disclaimer</h1>
<p>
The opinions expressed herein are my own personal opinions and do not necessarily represent the opinion of any other organization or person, including (but not limited to) my fellow employees, my employer, its clients or their agents. 
</p>
<p>
 Copyright &copy; 2011 - Björn Rochel
</p>
<section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Björn Rochel -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'bjro';
      
        

				//var disqus_developer = 1;
				var disqus_identifier = 'http://www.bjoernrochel.de/2010/04/19/testing-f-code-with-xunit-net-on-net-4-0/';
				var disqus_url = 'http://www.bjoernrochel.de/2010/04/19/testing-f-code-with-xunit-net-on-net-4-0/';
        var disqus_script = 'embed.js';
      

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>







</body>
</html>
