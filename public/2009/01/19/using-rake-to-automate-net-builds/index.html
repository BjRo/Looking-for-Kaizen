
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Using Rake to automate .NET builds - Dude, where's my Kaizen?</title>
  <meta name="author" content="BjÃ¶rn Rochel">

  
  <meta name="description" content="Today I started writing my first build scripts in Ruby for a .NET project using Rake.This is what I came up with.My fist rake &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.bjoernrochel.de/2009/01/19/using-rake-to-automate-net-builds/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Dude, where's my Kaizen?" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <header role="banner"><div id="logo">
	<img src="/images/kaizen.png" alt="Kaizen" title="Kaizen" />
</div>
<hgroup>
  <h1><a href="/">Dude, where's my Kaizen?</a></h1>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.bjoernrochel.de" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Using Rake to Automate .NET Builds</h1>
    
    
      <p class="meta">
        





  



<time datetime="2009-01-19T19:12:05+01:00" pubdate  data-updated="true" >Jan 19<span>th</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Today I started writing my first build scripts in Ruby for a .NET project using Rake.
This is what I came up with.</p>

<figure class='code'><figcaption><span>My fist rake script</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rake/clean&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="no">EXTERNALS_DIR</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../Externals&#39;</span><span class="p">)</span>
</span><span class='line'><span class="no">BUILD_DIR</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../Bin&#39;</span><span class="p">)</span>
</span><span class='line'><span class="no">SOURCE_DIR</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../Source&#39;</span><span class="p">)</span>
</span><span class='line'><span class="no">CLEAN</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="no">FileList</span><span class="o">[</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">BUILD_DIR</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">desc</span> <span class="s2">&quot;Compiles the gemini sources&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:build</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gemini_solution</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">SOURCE_DIR</span><span class="p">,</span> <span class="s1">&#39;Gemini.sln&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">sh</span> <span class="s2">&quot;msbuild /property:WarningLevel=4;OutDir=</span><span class="si">#{</span><span class="no">BUILD_DIR</span><span class="si">}</span><span class="s2">/ </span><span class="si">#{</span><span class="n">gemini_solution</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">desc</span> <span class="s2">&quot;Runs all the tests on the gemini code&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:test</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">assemblies</span> <span class="o">=</span> <span class="n">all_spec_assemblies</span><span class="p">()</span>
</span><span class='line'>  <span class="n">xunit_console</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">EXTERNALS_DIR</span><span class="p">,</span> <span class="s2">&quot;xUnit/xunit.console.exe&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">assemblies</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">assembly</span><span class="o">|</span>
</span><span class='line'>      <span class="n">sh</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">xunit_console</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">assembly</span><span class="si">}</span><span class="s2"> /html </span><span class="si">#{</span><span class="n">assembly</span> <span class="o">+</span><span class="s1">&#39;.UnitTests.html&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">task</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:clean</span><span class="p">,</span> <span class="ss">:build</span><span class="p">,</span> <span class="ss">:test</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">all_spec_assemblies</span><span class="p">()</span>
</span><span class='line'>  <span class="n">file_mask</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">BUILD_DIR</span><span class="p">,</span> <span class="s1">&#39;*Specs.dll&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="no">FileList</span><span class="o">[</span><span class="n">file_mask</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I think this code demonstrates the qualities of Ruby as a scripting language and Rake as a build tool really well.
It&#8217;s very descriptive and even more important it doesn&#8217;t have all the xml-slash-what-the-hell-is-going-on-here-noise
around it. I know it&#8217;s a very simple solution, but I consider it a good start. Let&#8217;s look a bit more detailed at the parts of the script.</p>

<figure class='code'><figcaption><span>Defining paths </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">EXTERNALS_DIR</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../Externals&#39;</span><span class="p">)</span>
</span><span class='line'><span class="no">BUILD_DIR</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../Bin&#39;</span><span class="p">)</span>
</span><span class='line'><span class="no">SOURCE_DIR</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../Source&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This part defines some directory constants that are used in the script. The rakefile is currently run from the directory &#8216;Build&#8217;
which is on the same level as &#8216;Externals&#8217;, &#8216;Bin&#8217; and &#8216;Source&#8217;. Relative paths are expanded to absolute paths here.</p>

<figure class='code'><figcaption><span>Using the built-in clean task</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">CLEAN</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="no">FileList</span><span class="o">[</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">BUILD_DIR</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This tiny little code piece modifies the built-in :clean task and adds all files under the BUILD_DIR to it. Running &#8216;rake clean&#8217; on the console
will now delete all files from our build directory.</p>

<figure class='code'><figcaption><span>Invoking the sources</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">desc</span> <span class="s2">&quot;Compiles the gemini sources&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:build</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gemini_solution</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">SOURCE_DIR</span><span class="p">,</span> <span class="s1">&#39;Gemini.sln&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">sh</span> <span class="s2">&quot;msbuild /property:WarningLevel=4;OutDir=</span><span class="si">#{</span><span class="no">BUILD_DIR</span><span class="si">}</span><span class="s2">/ </span><span class="si">#{</span><span class="n">gemini_solution</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is the first task I&#8217;ve actually written on my own. It&#8217;s only a very small wrapper around msbuild that builds the
solution file.</p>

<figure class='code'><figcaption><span>running tests</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">desc</span> <span class="s2">&quot;Runs all the tests on the gemini code&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:test</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">assemblies</span> <span class="o">=</span> <span class="n">all_spec_assemblies</span><span class="p">()</span>
</span><span class='line'>  <span class="n">xunit_console</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">EXTERNALS_DIR</span><span class="p">,</span> <span class="s2">&quot;xUnit/xunit.console.exe&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">assemblies</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">assembly</span><span class="o">|</span>
</span><span class='line'>      <span class="n">sh</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">xunit_console</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">assembly</span><span class="si">}</span><span class="s2"> /html </span><span class="si">#{</span><span class="n">assembly</span> <span class="o">+</span><span class="s1">&#39;.UnitTests.html&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">all_spec_assemblies</span><span class="p">()</span>
</span><span class='line'>  <span class="n">file_mask</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">BUILD_DIR</span><span class="p">,</span> <span class="s1">&#39;*Specs.dll&#39;</span><span class="p">)</span> <span class="no">FileList</span><span class="o">[</span><span class="n">file_mask</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>That little code is a small wrapper around xUnit.net which invokes the xunit.console.exe for each file it finds in the build
directory that ends with &#8216;Spec.dll&#8217;. These are the assemblies which contain the BDD-style tests in our project.</p>

<figure class='code'><figcaption><span>Defining the default task</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">task</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:clean</span><span class="p">,</span> <span class="ss">:build</span><span class="p">,</span> <span class="ss">:test</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>This last piece defines the :default build task. That&#8217;s the task which is run when you don&#8217;t specify a task directly when running rake from console.
This will run all tasks in the order specified from left to right.</p>

<h2>Conclusion</h2>

<p>The Rake build engine rocks !!! Its really simple and descriptive API is fun and Rake doesn&#8217;t create a lot of ceremony around build scripts (Only
around 30 lines of code in my current script). However, you should be aware of one thing: Coming from a language with a lot of IDE support
(like C# in my case) to Ruby might not be as easy as it sounds. It took me quite a while to make the transition from Intellisense and Resharper
to using IRB and reading RDoc in order to explore new APIs &#8230;</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">BjRo</span></span>

      





  



<time datetime="2009-01-19T19:12:05+01:00" pubdate  data-updated="true" >Jan 19<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/ruby/'>ruby</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.bjoernrochel.de/2009/01/19/using-rake-to-automate-net-builds/" data-via="bjoernrochel" data-counturl="http://www.bjoernrochel.de/2009/01/19/using-rake-to-automate-net-builds/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
</div>

    
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
	<h1>About me</h1>
  <p><br/><img src="/images/bjro-eyes.jpg" alt="portrait" /></p>
	<p>
  My name is <strong>BjÃ¶rn Rochel</strong>.  I'm a 32 year old geek, who's crazy about software development, living in Cologne and
  currently working for <a href="http://www.intercomponentware.com">ICW</a> as a .NET Developer / Architect.
	</p>
	<ul class="badges">
		<li><a href="http://www.xing.com/profile/Bjoern_Rochel"><img src="/images/badges/xing2-small.png" alt="Xing" /></a></li>
		<li><a href="http://www.github.com/BjRo"><img src="/images/badges/github-small.png" alt="Github" /></a></li>
		<li><a href="http://www.twitter.com/bjoernrochel"><img src="/images/badges/twitter-square-small.png" alt="Twitter" /></a></li>
		<li><a href="/atom.xml"><img src="/images/badges/rss-circle-small.png" alt="Rss" /></a></li>
	</ul>
</section>

<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/Conferences/'>Conferences (8)</a></li>
<li class='category'><a href='/blog/categories/FSharp/'>FSharp (3)</a></li>
<li class='category'><a href='/blog/categories/Katas/'>Katas (2)</a></li>
<li class='category'><a href='/blog/categories/StoryTeller/'>StoryTeller (14)</a></li>
<li class='category'><a href='/blog/categories/StructureMap/'>StructureMap (9)</a></li>
<li class='category'><a href='/blog/categories/Testing/'>Testing (20)</a></li>
<li class='category'><a href='/blog/categories/Uncategorized/'>Uncategorized (8)</a></li>
<li class='category'><a href='/blog/categories/dotnet/'>dotnet (65)</a></li>
<li class='category'><a href='/blog/categories/ruby/'>ruby (3)</a></li>
<li class='category'><a href='/blog/categories/sw-design/'>sw-design (13)</a></li>
<li class='category'><a href='/blog/categories/xUnitBDDExtensions/'>xUnitBDDExtensions (15)</a></li>

  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("bjoernrochel", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/bjoernrochel" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @bjoernrochel</a>
  
</section>

<section>
<h1>Disclaimer</h1>
<p>
The opinions expressed herein are my own personal opinions and do not necessarily represent the opinion of any other organization or person, including (but not limited to) my fellow employees, my employer, its clients or their agents. 
</p>
<p>
 Copyright &copy; 2011 - BjÃ¶rn Rochel
</p>
<section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - BjÃ¶rn Rochel -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'bjro';
      
        

				//var disqus_developer = 1;
				var disqus_identifier = 'http://www.bjoernrochel.de/2009/01/19/using-rake-to-automate-net-builds/';
				var disqus_url = 'http://www.bjoernrochel.de/2009/01/19/using-rake-to-automate-net-builds/';
        var disqus_script = 'embed.js';
      

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>







</body>
</html>
