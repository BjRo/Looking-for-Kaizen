
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Diving into the StoryTeller trunk, Part 5: The EventAggregator - Dude, where's my Kaizen?</title>
  <meta name="author" content="BjÃ¶rn Rochel">

  
  <meta name="description" content="I&#8217;ve spend some time with the Pub / Sub topic on my own in the past. Although Istill like my own implementation, even a year after I&#8217;ve &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.bjoernrochel.de/2009/07/20/diving-into-the-storyteller-trunk-part-5-the-eventaggregator/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Dude, where's my Kaizen?" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <header role="banner"><div id="logo">
</div>
<hgroup>
  <h1><a href="/">Dude, where's my Kaizen?</a></h1>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.bjoernrochel.de" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Diving Into the StoryTeller Trunk, Part 5: The EventAggregator</h1>
    
    
      <p class="meta">
        





  



<time datetime="2009-07-20T21:19:11+02:00" pubdate  data-updated="true" >Jul 20<span>th</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>I&#8217;ve spend some time with the Pub / Sub topic on my own in the past. Although I
still like my own implementation, even a year after I&#8217;ve originally
written it (yes, rare but sometimes that happens), I really like how
Jeremy implemented it. The <code>EventAggregator</code> in StoryTeller is one of
those examples of how much you can achieve with only a few lines of
code. So let&#8217;s go diving again ;-)</p>

<p>A type who is interested in recieving messages from the EventAggregator
in StoryTeller has to implement the <code>IListener&lt;T&gt;</code> interface where T
specifies the concrete message / event. A container extension is used
for automatic registration of instances at the <code>EventAggregator</code> after
instances have been created in the container (more on this later in the
post).</p>

<figure class='code'><figcaption><span>The listener interface </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">interface</span> <span class="n">IListener</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">void</span> <span class="nf">Handle</span><span class="p">(</span><span class="n">T</span> <span class="n">message</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The interface to the <code>EventAggregator</code> looks like this.</p>

<figure class='code'><figcaption><span>The EventAggregator interface </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">interface</span> <span class="n">IEventAggregator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">void</span> <span class="n">SendMessage</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">Action</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">action</span><span class="p">)</span> <span class="n">where</span> <span class="n">T</span> <span class="p">:</span> <span class="n">class</span><span class="p">;</span>
</span><span class='line'>  <span class="k">void</span> <span class="n">SendMessage</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">T</span> <span class="n">message</span><span class="p">);</span>
</span><span class='line'>  <span class="k">void</span> <span class="nf">AddListener</span><span class="p">(</span><span class="kt">object</span> <span class="n">listener</span><span class="p">);</span>
</span><span class='line'>  <span class="k">void</span> <span class="nf">RemoveListener</span><span class="p">(</span><span class="kt">object</span> <span class="n">listener</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Most of the interface looks familiar to me, except the
<code>SendMessage&lt;T&gt;(Action&lt;T&gt; action)</code> method. The <code>EventAggregator</code>
implementation in StoryTeller adds a interesting feature to the topic:
Using delegates instead of explicit event classes. One of the things
Jeremy mentioned in his NDC &#8220;Presentation Patterns&#8221; talk is that
sometimes creating event classes for events felt a bit tedious to him,
especially when those events only have signal character and don&#8217;t carry
any data with them around. IIRIC the varation with delegates instead of
event classes implemented in StoryTeller came up in discussion with
Glenn Block and the Prism team. However it didn&#8217;t make it into Prism in
the end. See the difference in usage for yourself:</p>

<figure class='code'><figcaption><span>Classic vs. delegate based messaging</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="c1">//Using message objects </span>
</span><span class='line'><span class="n">aggregator</span><span class="p">.</span><span class="n">SendMessage</span><span class="p">(</span><span class="k">new</span> <span class="n">ScreenClosingMessage</span><span class="p">(</span><span class="n">screen</span><span class="p">));</span>
</span><span class='line'><span class="c1">//Using delegates as messages</span>
</span><span class='line'><span class="n">aggregator</span><span class="p">.</span><span class="n">SendMessage</span><span class="p">&lt;</span><span class="n">IWantToKnowWhenAScreenClosed</span><span class="p">&gt;(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">ScreenHasClosed</span><span class="p">(</span><span class="n">screen</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>Below is the code for the <code>EventAggregator</code>. There are some interesting things to notice.</p>

<ul>
<li>First of all, the <code>EventBroker</code> doesn&#8217;t know about subscriptions for a
particular type. It only knows listener objects. Compatible
listeners are found on the fly when the event / message is published
by iterating over all known listener objects and calling the CallOn
extension method. I&#8217;ll spare the code for this extension method
because all it does is executing an <code>Action&lt;T&gt;</code> only when an object
can be cast to the type specified by <code>T</code>.</li>
<li>Automatic thread-synchronization to the main-thread is applied by
using the <code>SynchronizationContext</code> class. Imho, one of the gems in the
.NET 2.0 release that more people should be aware of. I think this
class is a really great feature for freeing client code from dealing
with callback synchronization issues. Just let the framework handle
the <code>InvokeRequired</code> stuff for you. No one likes to write that stuff
anyway.</li>
<li>Jeremy likes it functional ;-). I think this is an interesting
example how C# 3.0 code can actually differ from an 1.0
implementation. The shown code is really, really dense and focussed
by using a lot of the C# 2.0 and 3.0 features like lamda
expressions, extension methods and of course generics. Personally I
really like this coding style, however a lot of my colleagues don&#8217;t.
The debugging story differs a lot from the one using classic if and
for loops, which isn&#8217;t such a problem for the test-first or
test-parallel guys, but I can see where this might feel a bit
awkward when you&#8217;ve relied on the debugger for most of your
developing efforts in the past. In my opinion it&#8217;s just a matter of
personal taste. Just give it a try and make your own opinion &#8230;</li>
</ul>


<figure class='code'><figcaption><span>The EventAggregator as implemented in StoryTeller</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">EventAggregator</span> <span class="p">:</span> <span class="n">IEventAggregator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">readonly</span> <span class="n">SynchronizationContext</span> <span class="n">_context</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;</span> <span class="n">_listeners</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">object</span><span class="p">&gt;();</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">readonly</span> <span class="kt">object</span> <span class="n">_locker</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">object</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="nf">EventAggregator</span><span class="p">(</span><span class="n">SynchronizationContext</span> <span class="n">context</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">_context</span> <span class="p">=</span> <span class="n">context</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cp">#region IEventAggregator Members </span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="n">SendMessage</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">Action</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">action</span><span class="p">)</span> <span class="n">where</span> <span class="n">T</span> <span class="p">:</span> <span class="k">class</span>
</span><span class='line'>  <span class="err">{ </span>
</span><span class='line'>    <span class="n">sendAction</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">all</span><span class="p">().</span><span class="n">Each</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">CallOn</span><span class="p">(</span><span class="n">action</span><span class="p">)));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="n">SendMessage</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n">T</span> <span class="n">message</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">sendAction</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">all</span><span class="p">().</span><span class="n">CallOnEach</span><span class="p">&gt;(</span><span class="n">x</span> <span class="p">=&gt;</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="n">x</span><span class="p">.</span><span class="n">Handle</span><span class="p">(</span><span class="n">message</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">AddListener</span><span class="p">(</span><span class="kt">object</span> <span class="n">listener</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">withinLock</span><span class="p">(()</span> <span class="p">=&gt;</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="p">(</span><span class="n">_listeners</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">listener</span><span class="p">))</span> <span class="k">return</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">_listeners</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">listener</span><span class="p">);</span>
</span><span class='line'>    <span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">RemoveListener</span><span class="p">(</span><span class="kt">object</span> <span class="n">listener</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">withinLock</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">_listeners</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">listener</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cp">#endregion </span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">AddListeners</span><span class="p">(</span><span class="k">params</span> <span class="kt">object</span><span class="p">[]</span> <span class="n">listeners</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="k">foreach</span> <span class="p">(</span><span class="kt">object</span> <span class="n">listener</span> <span class="k">in</span> <span class="n">listeners</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="n">AddListener</span><span class="p">(</span><span class="n">listener</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="kt">bool</span> <span class="nf">HasListener</span><span class="p">(</span><span class="kt">object</span> <span class="n">listener</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">_listeners</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">listener</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">RemoveAllListeners</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">_listeners</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">sendAction</span><span class="p">(</span><span class="n">Action</span> <span class="n">action</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">_context</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">state</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="n">action</span><span class="p">();</span> <span class="p">},</span> <span class="k">null</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">private</span> <span class="kt">object</span><span class="p">[]</span> <span class="nf">all</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="k">lock</span> <span class="p">(</span><span class="n">_locker</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">_listeners</span><span class="p">.</span><span class="n">ToArray</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">private</span> <span class="k">void</span> <span class="nf">withinLock</span><span class="p">(</span><span class="n">Action</span> <span class="n">action</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="k">lock</span><span class="p">(</span><span class="n">_locker</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="n">action</span><span class="p">();</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As I said earlier in this post, instances are registered after they&#8217;ve been
created by the container. The functionality for this is provided by a
TypeInterceptor class. This class is part of the StructureMap API. Once
it has been registered every created instances is passed through this
interceptor after it has been resolved. If the instance is identified as
relevant for the <code>EventAggregator</code> it is automatically registered.</p>

<figure class='code'><figcaption><span>Integrating the EventAggregator into StructureMap</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">EventAggregatorInterceptor</span> <span class="p">:</span> <span class="n">TypeInterceptor</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="cp">#region TypeInterceptor Members </span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="kt">object</span> <span class="nf">Process</span><span class="p">(</span><span class="kt">object</span> <span class="n">target</span><span class="p">,</span> <span class="n">IContext</span> <span class="n">context</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">context</span><span class="p">.</span><span class="n">GetInstance</span><span class="p">&lt;</span><span class="n">IEventAggregator</span><span class="p">&gt;().</span><span class="n">AddListener</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">target</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="kt">bool</span> <span class="nf">MatchesType</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">type</span><span class="p">.</span><span class="n">ImplementsInterfaceTemplate</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">IListener</span><span class="p">&lt;&gt;))</span> <span class="p">||</span>
</span><span class='line'>      <span class="n">type</span><span class="p">.</span><span class="n">CanBeCastTo</span><span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="n">ITestListener</span><span class="p">))</span> <span class="p">||</span>
</span><span class='line'>      <span class="n">type</span><span class="p">.</span><span class="n">CanBeCastTo</span><span class="p">(</span><span class="k">typeof</span> <span class="p">(</span><span class="n">ICloseable</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cp">#endregion </span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Conclusion</h2>

<p>EventAggregation is one of the standard patterns in modern enterprise
applications. I like the elegant way how Jeremy implemented this.
However having spend some time with this in the past, I miss a
functional part in his implementation: Type based subscriptions. Type
based subscriptions can be really handy when you&#8217;re implementing
PageFlows or state-ful MessageHandlers. Once a message is recieved the
type is resolved by the container and the related handler method is
called on the newly created type. I had them in my last application and
liked them a lot. Maybe StoryTeller goes alternative routes to achive a
similar effect. We&#8217;ll see as we proceed in the code &#8230;</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">BjRo</span></span>

      





  



<time datetime="2009-07-20T21:19:11+02:00" pubdate  data-updated="true" >Jul 20<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/storyteller/'>StoryTeller</a>, <a class='category' href='/blog/categories/structuremap/'>StructureMap</a>, <a class='category' href='/blog/categories/dotnet/'>dotnet</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.bjoernrochel.de/2009/07/20/diving-into-the-storyteller-trunk-part-5-the-eventaggregator/" data-via="bjoernrochel" data-counturl="http://www.bjoernrochel.de/2009/07/20/diving-into-the-storyteller-trunk-part-5-the-eventaggregator/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
</div>

    
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
	<h1>About me</h1>
  <p><br/><img src="/images/bjro-eyes.jpg" alt="portrait" /></p>
	<p>
  My name is <strong>BjÃ¶rn Rochel</strong>.  I'm a 32 year old geek, who's crazy about software development, living in Cologne and
  currently working for <a href="http://www.intercomponentware.com">ICW</a> as a Developer / Architect.
	</p>
	<ul id="badges">
    <li><a id="xing" href="http://www.xing.com/profile/Bjoern_Rochel"><span>XING</span></a></li>
    <li><a id="github" href="http://www.github.com/BjRo"><span>Github</span></a></li>
    <li><a id="twitter" href="http://www.twitter.com/bjoernrochel"><span>Twitter</span></a></li>
    <li><a id="rss" href="/atom.xml"><span>Rss</span></a></li>
	</ul>
</section>

<section>
  <h1>Categories</h1>
  <ul id='categories'>
<li><a href='blog/categories/Conferences/'>Conferences (8)</a></li>
<li><a href='blog/categories/FSharp/'>FSharp (3)</a></li>
<li><a href='blog/categories/Katas/'>Katas (2)</a></li>
<li><a href='blog/categories/StoryTeller/'>StoryTeller (14)</a></li>
<li><a href='blog/categories/StructureMap/'>StructureMap (9)</a></li>
<li><a href='blog/categories/Testing/'>Testing (20)</a></li>
<li><a href='blog/categories/Uncategorized/'>Uncategorized (8)</a></li>
<li><a href='blog/categories/dotnet/'>dotnet (65)</a></li>
<li><a href='blog/categories/ruby/'>ruby (3)</a></li>
<li><a href='blog/categories/sw-design/'>sw-design (13)</a></li>
<li><a href='blog/categories/xUnitBDDExtensions/'>xUnitBDDExtensions (15)</a></li>
</ul>

</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("bjoernrochel", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/bjoernrochel" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @bjoernrochel</a>
  
</section>

<section>
<h1>Disclaimer</h1>
<p>
The opinions expressed herein are my own personal opinions and do not necessarily represent the opinion of any other organization or person, including (but not limited to) my fellow employees, my employer, its clients or their agents. 
</p>
<p>
 Copyright &copy; 2011 - BjÃ¶rn Rochel
</p>
<section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - BjÃ¶rn Rochel -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'bjro';
      
        

				//var disqus_developer = 1;
				var disqus_identifier = 'http://www.bjoernrochel.de/2009/07/20/diving-into-the-storyteller-trunk-part-5-the-eventaggregator/';
				var disqus_url = 'http://www.bjoernrochel.de/2009/07/20/diving-into-the-storyteller-trunk-part-5-the-eventaggregator/';
        var disqus_script = 'embed.js';
      

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>







</body>
</html>
