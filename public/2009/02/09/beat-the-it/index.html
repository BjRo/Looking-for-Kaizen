
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Beat the It - Dude, where's my Kaizen?</title>
  <meta name="author" content="BjÃ¶rn Rochel">

  
  <meta name="description" content="&#8230; or how one could implement the It-Syntax introduced by MSpec. If you don&#8217;t know what the hell I&#8217;m talking about take a look at &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.bjoernrochel.de/2009/02/09/beat-the-it/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Dude, where's my Kaizen?" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <header role="banner"><div id="logo">
</div>
<hgroup>
  <h1><a href="/">Dude, where's my Kaizen?</a></h1>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.bjoernrochel.de" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Beat the It</h1>
    
    
      <p class="meta">
        





  



<time datetime="2009-02-09T11:45:55+01:00" pubdate  data-updated="true" >Feb 9<span>th</span>, 2009</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>&#8230; or how one could implement the It-Syntax introduced by MSpec. If you don&#8217;t know what the hell I&#8217;m talking about take a look at this code.
(I don&#8217;t know if that&#8217;s the current MSpec syntax but I think you&#8217;ll get where I&#8217;d like to take you &#8230; )</p>

<figure class='code'><figcaption><span>Using delegates for running a specification</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[Description]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Transferring_between_from_account_and_to_account</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">Account</span> <span class="n">fromAccount</span><span class="p">;</span>
</span><span class='line'>  <span class="k">static</span> <span class="n">Account</span> <span class="n">toAccount</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Context</span> <span class="n">before_each</span> <span class="p">=()=&gt;</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">fromAccount</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Account</span> <span class="p">{</span><span class="n">Balance</span> <span class="p">=</span> <span class="m">1</span><span class="n">m</span><span class="p">};</span>
</span><span class='line'>      <span class="n">toAccount</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Account</span> <span class="p">{</span><span class="n">Balance</span> <span class="p">=</span> <span class="m">1</span><span class="n">m</span><span class="p">};</span>
</span><span class='line'>  <span class="p">};</span>
</span><span class='line'>      
</span><span class='line'>  <span class="n">When</span> <span class="n">the_transfer_is_made</span> <span class="p">=()=&gt;</span> <span class="n">fromAccount</span><span class="p">.</span><span class="n">Transfer</span><span class="p">(</span><span class="m">1</span><span class="n">m</span><span class="p">,</span> <span class="n">toAccount</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">It</span> <span class="n">should_debit_the_from_account_by_the_amount_transferred</span> <span class="p">=</span>
</span><span class='line'>      <span class="p">()=&gt;</span> <span class="n">fromAccount</span><span class="p">.</span><span class="n">Balance</span><span class="p">.</span><span class="n">ShouldEqual</span><span class="p">(</span><span class="m">0</span><span class="n">m</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">It</span> <span class="n">should_credit_the_to_account_by_the_amount_transferred</span> <span class="p">=</span>
</span><span class='line'>      <span class="p">()=&gt;</span> <span class="n">toAccount</span><span class="p">.</span><span class="n">Balance</span><span class="p">.</span><span class="n">ShouldEqual</span><span class="p">(</span><span class="m">2</span><span class="n">m</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>What you&#8217;ll see in this post is part of a spike I did some month ago <a href="http://www.bjoernrochel.de/2008/11/27/a-new-syntax-for-xunitbddextensions/">while I was considering</a>
to move the xUnit.BDDExtensions syntax to something more GWT and MSpec like. I finally decided against that, partially because I realized that
there is absolutely no need for a MSpec-Clone; partially because I&#8217;m still not so happy with the implications / side effects of the syntax
(nearly everything in you spec needs to become static). Anyway, <a href="http://blog.jpboodhoo.com/SlightAdditionToJpboodhoobdd.aspx">recently</a>
JP Boodhoo introduced the same feature to his jpboodhoo.bdd codebase. A lot of the comments requested a more detailed description of how he
implemented that feature. While I can&#8217;t answer that question, I can talk about how I tackled that problem. So here we go!</p>

<!--more -->


<h2>Some prerequisites first</h2>

<p>If you wonder how such a sweet syntax is possible in C#, here are some clues:</p>

<ul>
<li><code>It</code> uses fields with ommited access modifiers (therefore private fields).</li>
<li><code>It</code>, <code>When</code>, etc. are <code>Delegate</code> types.</li>
<li>Field-initializers are used to specifiy the delegates inline. (and because field-initializers are run before the constructor you can
only access static and no instance members here. Thats the sideeffect I mentioned earlier).</li>
</ul>


<h2>A closer look at my spike</h2>

<p>The following class is the heart of the spike I implemented. It takes a blank object and uses reflection to
build an <code>ISpecHandler</code> instance which is ultimately used to run the specification.</p>

<figure class='code'><figcaption><span>Creating a wrapper for running a spec</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">SpecFactory</span> <span class="p">:</span> <span class="n">ISpecFactory</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="n">ISpecHandler</span> <span class="nf">CreateSpecFrom</span><span class="p">(</span><span class="kt">object</span> <span class="n">candidate</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>          <span class="n">var</span> <span class="n">fields</span> <span class="p">=</span> <span class="n">candidate</span><span class="p">.</span><span class="n">AllFields</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">return</span> <span class="n">fields</span><span class="p">.</span><span class="n">AllFixtureInitializers</span><span class="p">()</span>
</span><span class='line'>              <span class="p">.</span><span class="n">Then</span><span class="p">(</span><span class="n">fields</span><span class="p">.</span><span class="n">AllContextInitializers</span><span class="p">())</span>
</span><span class='line'>              <span class="p">.</span><span class="n">Then</span><span class="p">(</span><span class="n">fields</span><span class="p">.</span><span class="n">AllContextFinalizers</span><span class="p">())</span>
</span><span class='line'>              <span class="p">.</span><span class="n">Then</span><span class="p">(</span><span class="n">fields</span><span class="p">.</span><span class="n">BehaviorUnderTest</span><span class="p">())</span>
</span><span class='line'>              <span class="p">.</span><span class="n">Then</span><span class="p">(</span><span class="n">fields</span><span class="p">.</span><span class="n">AllObservations</span><span class="p">())</span>
</span><span class='line'>              <span class="p">.</span><span class="n">ThenFinally</span><span class="p">(</span><span class="n">fields</span><span class="p">.</span><span class="n">AllFixtureCleaners</span><span class="p">());</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you might guess a lot of extension methods are used in here, together with the composite pattern. Lets start be inspecting the <code>AllFields()</code>
extension method.</p>

<figure class='code'><figcaption><span>Extracting delegates fields from a specification</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">IFieldInfo</span><span class="p">&gt;</span> <span class="n">AllFields</span><span class="p">(</span><span class="k">this</span> <span class="kt">object</span> <span class="n">instance</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">var</span> <span class="n">mask</span> <span class="p">=</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Instance</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">Static</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">NonPublic</span> <span class="p">|</span> <span class="n">BindingFlags</span><span class="p">.</span><span class="n">FlattenHierarchy</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">instance</span><span class="p">.</span><span class="n">GetType</span><span class="p">().</span><span class="n">GetFields</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">FieldInfoAdapter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">instance</span><span class="p">));</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As its name implies this method reflects all the fields from the supplied object. It returns a collection of <code>IFieldInfo</code> objects.
<code>IFieldInfo</code>? Yes I introduced a little adapter here, which helped me to introduce better test isolation in the spike code.</p>

<figure class='code'><figcaption><span>An adapter around the FieldInfo class</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">FieldInfoAdapter</span> <span class="p">:</span> <span class="n">IFieldInfo</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">readonly</span> <span class="n">FieldInfo</span> <span class="n">fieldInfo</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">readonly</span> <span class="kt">object</span> <span class="n">host</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">public</span> <span class="nf">FieldInfoAdapter</span><span class="p">(</span><span class="n">FieldInfo</span> <span class="n">fieldInfo</span><span class="p">,</span> <span class="kt">object</span> <span class="n">host</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="n">fieldInfo</span> <span class="p">=</span> <span class="n">fieldInfo</span><span class="p">;</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="n">host</span> <span class="p">=</span> <span class="n">host</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">public</span> <span class="kt">object</span> <span class="nf">ReadValue</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">fieldInfo</span><span class="p">.</span><span class="n">GetValue</span><span class="p">(</span><span class="n">host</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">public</span> <span class="n">Type</span> <span class="n">FieldType</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">get</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="n">fieldInfo</span><span class="p">.</span><span class="n">FieldType</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">public</span> <span class="kt">string</span> <span class="n">Name</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">get</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="n">fieldInfo</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And here is how the code that finds all the It delegates was implemented.</p>

<figure class='code'><figcaption><span>Searching for It delegates</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="n">ISpecHandler</span> <span class="nf">AllObservations</span><span class="p">(</span><span class="k">this</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">IFieldInfo</span><span class="p">&gt;</span> <span class="n">fields</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">return</span> <span class="n">fields</span><span class="p">.</span><span class="n">AllHandlersOf</span><span class="p">().</span><span class="n">AsOne</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">private</span> <span class="k">static</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">ISpecHandler</span><span class="p">&gt;</span> <span class="n">AllHandlersOf</span><span class="p">(</span><span class="k">this</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">IFieldInfo</span><span class="p">&gt;</span> <span class="n">fields</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">return</span> <span class="n">fields</span><span class="p">.</span><span class="n">Where</span><span class="p">(</span><span class="n">field</span> <span class="p">=&gt;</span> <span class="n">field</span><span class="p">.</span><span class="n">FieldType</span> <span class="p">==</span> <span class="k">typeof</span><span class="p">(</span><span class="n">HandlerType</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">field</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">StartsWith</span><span class="p">(</span><span class="s">&quot;CS$&quot;</span><span class="p">))</span>
</span><span class='line'>     <span class="p">.</span><span class="n">Select</span><span class="p">(</span><span class="n">field</span> <span class="p">=&gt;</span> <span class="k">new</span> <span class="n">SpecHandler</span><span class="p">((</span><span class="n">Delegate</span><span class="p">)</span><span class="n">field</span><span class="p">.</span><span class="n">ReadValue</span><span class="p">()));</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">private</span> <span class="k">static</span> <span class="n">ISpecHandler</span> <span class="nf">AsOne</span><span class="p">(</span><span class="k">this</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">ISpecHandler</span><span class="p">&gt;</span> <span class="n">specHandler</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>   <span class="k">return</span> <span class="k">new</span> <span class="nf">CompositeSpecHandler</span><span class="p">(</span><span class="n">specHandler</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The basic stuff happens in the <code>AllHandlersOf</code> method which filters the supplied fields by the field type and also removes all compiler generated fields (which
start with <code>CS$</code> in their names). The content (aka the delegate) of each field that is left is read and wrapped in a <code>SpecHandler</code> instance.</p>

<figure class='code'><figcaption><span>A wrapper for invoking a Delegate</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">SpecHandler</span> <span class="p">:</span> <span class="n">ISpecHandler</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">readonly</span> <span class="n">Delegate</span> <span class="n">handler</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="nf">SpecHandler</span><span class="p">(</span><span class="n">Delegate</span> <span class="n">handler</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="n">handler</span> <span class="p">=</span> <span class="n">handler</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">Run</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">try</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">handler</span><span class="p">.</span><span class="n">DynamicInvoke</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">catch</span> <span class="p">(</span><span class="n">TargetInvocationException</span> <span class="n">e</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">throw</span> <span class="n">e</span><span class="p">.</span><span class="n">InnerException</span><span class="p">.</span><span class="n">PreserveStackTrace</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Last but not least there is the <code>Then</code> extension method which uses the composite pattern to wrap all found spec handlers into a single instance.</p>

<figure class='code'><figcaption><span>Chaining SpecHandlers together</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="n">ISpecHandler</span> <span class="nf">Then</span><span class="p">(</span><span class="k">this</span> <span class="n">ISpecHandler</span> <span class="n">handler</span><span class="p">,</span> <span class="n">ISpecHandler</span> <span class="n">handlerToRunAfterwards</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">new</span> <span class="nf">CompositeSpecHandler</span><span class="p">(</span><span class="k">new</span><span class="p">[]</span> <span class="p">{</span> <span class="n">handler</span><span class="p">,</span> <span class="n">handlerToRunAfterwards</span> <span class="p">});</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Conclusion</h2>

<p>It&#8217;s not as hard to implement such a syntax in C# as one might initially think. Although the code shown in this
post is only spike code and not considered production ready, you can derive all what&#8217;s necessary to implement such a syntax. Fields, omitted
access modifiers, field-initializers and delegates are the basic parts together with some reflection logic to execute the code.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">BjRo</span></span>

      





  



<time datetime="2009-02-09T11:45:55+01:00" pubdate  data-updated="true" >Feb 9<span>th</span>, 2009</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/testing/'>Testing</a>, <a class='category' href='/blog/categories/dotnet/'>dotnet</a>, <a class='category' href='/blog/categories/sw-design/'>sw-design</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.bjoernrochel.de/2009/02/09/beat-the-it/" data-via="bjoernrochel" data-counturl="http://www.bjoernrochel.de/2009/02/09/beat-the-it/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
</div>

    
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
	<h1>About me</h1>
  <p><br/><img src="/images/bjro-eyes.jpg" alt="portrait" /></p>
	<p>
  My name is <strong>BjÃ¶rn Rochel</strong>.  I'm a 32 year old geek, who's crazy about software development, living in Cologne and
  currently working for <a href="http://www.intercomponentware.com">ICW</a> as a Developer / Architect.
	</p>
	<ul id="badges">
    <li><a id="xing" href="http://www.xing.com/profile/Bjoern_Rochel"><span>XING</span></a></li>
    <li><a id="github" href="http://www.github.com/BjRo"><span>Github</span></a></li>
    <li><a id="twitter" href="http://www.twitter.com/bjoernrochel"><span>Twitter</span></a></li>
    <li><a id="rss" href="/atom.xml"><span>Rss</span></a></li>
	</ul>
</section>

<section>
  <h1>Categories</h1>
  <ul id='categories'>
<li><a href='blog/categories/Conferences/'>Conferences (8)</a></li>
<li><a href='blog/categories/FSharp/'>FSharp (3)</a></li>
<li><a href='blog/categories/Katas/'>Katas (2)</a></li>
<li><a href='blog/categories/StoryTeller/'>StoryTeller (14)</a></li>
<li><a href='blog/categories/StructureMap/'>StructureMap (9)</a></li>
<li><a href='blog/categories/Testing/'>Testing (20)</a></li>
<li><a href='blog/categories/Uncategorized/'>Uncategorized (8)</a></li>
<li><a href='blog/categories/dotnet/'>dotnet (65)</a></li>
<li><a href='blog/categories/ruby/'>ruby (3)</a></li>
<li><a href='blog/categories/sw-design/'>sw-design (13)</a></li>
<li><a href='blog/categories/xUnitBDDExtensions/'>xUnitBDDExtensions (15)</a></li>
</ul>

</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("bjoernrochel", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/bjoernrochel" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @bjoernrochel</a>
  
</section>

<section>
<h1>Disclaimer</h1>
<p>
The opinions expressed herein are my own personal opinions and do not necessarily represent the opinion of any other organization or person, including (but not limited to) my fellow employees, my employer, its clients or their agents. 
</p>
<p>
 Copyright &copy; 2011 - BjÃ¶rn Rochel
</p>
<section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - BjÃ¶rn Rochel -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'bjro';
      
        

				//var disqus_developer = 1;
				var disqus_identifier = 'http://www.bjoernrochel.de/2009/02/09/beat-the-it/';
				var disqus_url = 'http://www.bjoernrochel.de/2009/02/09/beat-the-it/';
        var disqus_script = 'embed.js';
      

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>







</body>
</html>
