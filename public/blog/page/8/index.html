
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dude, where's my Kaizen?</title>
  <meta name="author" content="BjÃ¶rn Rochel">

  
  <meta name="description" content="We&#8217;re now half way through the course and I must say that it&#8217;s even abetter experience than I originally expected. I&#8217;ve got to know &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.bjoernrochel.de/blog/page/8/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Dude, where's my Kaizen?" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <header role="banner"><div id="logo">
</div>
<hgroup>
  <h1><a href="/">Dude, where's my Kaizen?</a></h1>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.bjoernrochel.de" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/09/24/nothing-but-net-germany-half-time-recap/">Nothing but .NET Germany - Half Time Recap</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2008-09-24T23:04:36+02:00" pubdate  data-updated="true" >Sep 24<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>We&#8217;re now half way through the course and I must say that it&#8217;s even a
better experience than I originally expected. I&#8217;ve got to know a lot of
very interesting, smart and also very kind people this week. The
chemistry in the course is just amazing. The course itself is radically
different from any training I&#8217;ve ever received. The level of interaction
between JP and the participants is REALLY high. The content of the
course is worth a lot of posts. Just to give you a sneak peak on what
we&#8217;re currently doing: We&#8217;re actually developing software. JP showed not
a single PowerPoint-slide this week. In a Jeremy Miller you could
headline some of the things we&#8217;re currently developing &#8220;Build your own
ASP.NET MVC&#8221;. We&#8217;re basically developing a web application from scratch</p>

<ol>
<li>based on a FronController architecture &#8230;</li>
<li>build iterative in a top down manner &#8230;</li>
<li>in pair programming sessions &#8230;</li>
<li>using a test first approach with BDD &#8230; .</li>
<li>continuously integrated &#8230;</li>
<li>with extensive usage of fluent interfaces / internal DSLs.</li>
</ol>


<p>It&#8217;s a bit like being a kid at toy shop (of course in a developer way ;-) ) .
It&#8217;s pretty exhausting, though. To give you an idea how long a day with JP can actually be:</p>

<ol>
<li>Monday 14h</li>
<li>Thursday 14h</li>
<li>Wednesday 16h</li>
</ol>


<p>Conclusion There is one thing I can already say at the current stage of the course:
If you ever get the opportunity to be a week with JP and you&#8217;re passionate about .NET software development: <em>DON&#8217;T MISS IT</em>.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/09/16/bdd-and-xunit-continued/">BDD and xUnit Continued</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2008-09-16T20:00:55+02:00" pubdate  data-updated="true" >Sep 16<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Because of several requests I uploaded the little BDD extension I recently wrote for xunit. It&#8217;s basically a port of the framework JP
Boodhoos currently uses in his famous Nothing but .Net bootcamps (he&#8217;s using MbUnit).</p>

<p>So <a href="http://www.github.com/bjro/xunitbddextensions">here</a> it is.</p>

<p>Any feedback is appreciated &#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/09/04/resharper-41/">Resharper 4.1</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2008-09-04T21:31:14+02:00" pubdate  data-updated="true" >Sep 4<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Cool, Jetbrains just released a new version of it&#8217;s famous productivity enhancer. I&#8217;m going to update my development machine tomorrow. It&#8217;s just an awesome tool &#8230;</p>

<p>See <a href="http://blogs.jetbrains.com/dotnet/2008/09/resharper-41-is-released/">http://blogs.jetbrains.com/dotnet/2008/09/resharper-41-is-released/</a> for more information.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/09/02/bdd-xunit-and-resharper/">BDD, xUnit and Resharper</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2008-09-02T18:01:19+02:00" pubdate  data-updated="true" >Sep 2<span>nd</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Yesterday was an interesting evening. I tried to pinpoint the problem between the little BDD framework I used and the Resharper addin for
xUnit.</p>

<h2>A short description of my problem</h2>

<p>I&#8217;m using a test-case-class-per-fixture organization and the template method pattern
for writing tests in the AAA scheme. Besides that I use a specialized <code>FactAttribute</code> in order to invoke my AAA - hook methods in the correct
order. All of this is residing in a separate assembly. When I use the build-in <code>FactAttribute</code> to mark my tests alll tests are discovered by the
Resharper&#8217;s TestExplorer, but when I&#8217;m using my own marker attributes nothing is discovered.</p>

<h2>What seems to be the problem </h2>

<p>It took me some time to find out what was actually going on. I&#8217;ve never debugged a Resharper-Plugin before.
<a href="http://www.jetbrains.net/confluence/display/ReSharper/Building,+running+and+debugging+plugin">This</a>
helped a lot. It was an interesting experience, though. Didn&#8217;t knew that there is so much going on behind the scenes. This is what I found out:</p>

<ul>
<li>The <code>XUnitTestProvider</code> class is responsible for discovering tests.</li>
<li>It skips all assemblies which don&#8217;t reference xunit directly.</li>
</ul>


<p>Hm, I had a reference to xunit in my test library project settings.
However I was not referencing xUnit stuff from my code directly (Own <code>FactAttribute</code> and <code>xunitext35</code> extension methods for assertions). That&#8217;s
when it hit me: My problem was probably caused by a compiler optimization. It seems that all unused assembly references are removed
when building the test assembly. A look into reflector supported my thesis. So my test assembly has no direct reference to the xunit.dll,
only an indirect one through the BDD framework.</p>

<h2>Patching this is quite easy</h2>

<p>This is the original method:</p>

<figure class='code'><figcaption><span>The original code</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">static</span> <span class="kt">bool</span> <span class="nf">IsTestAssembly</span><span class="p">(</span><span class="n">IMetadataAssembly</span> <span class="n">assembly</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">foreach</span> <span class="p">(</span><span class="n">AssemblyReference</span> <span class="n">reference</span> <span class="k">in</span> <span class="n">assembly</span><span class="p">.</span><span class="n">ReferencedAssembliesNames</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">reference</span><span class="p">.</span><span class="n">AssemblyName</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">ToLowerInvariant</span><span class="p">()</span> <span class="p">==</span> <span class="s">&quot;xunit&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>When changing this a bit to this, everything runs as expected.</p>

<figure class='code'><figcaption><span>The fix </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">static</span> <span class="kt">bool</span> <span class="nf">IsTestAssembly</span><span class="p">(</span><span class="n">IMetadataAssembly</span> <span class="n">assembly</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">foreach</span> <span class="p">(</span><span class="n">AssemblyReference</span> <span class="n">reference</span> <span class="k">in</span> <span class="n">assembly</span><span class="p">.</span><span class="n">ReferencedAssembliesNames</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="kt">string</span> <span class="n">assemblyName</span> <span class="p">=</span> <span class="n">reference</span><span class="p">.</span><span class="n">AssemblyName</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">ToLowerInvariant</span><span class="p">();</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">assemblyName</span><span class="p">.</span><span class="n">StartsWith</span><span class="p">(</span><span class="s">&quot;xunit&quot;</span><span class="p">))</span>
</span><span class='line'>          <span class="k">return</span> <span class="k">true</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">return</span> <span class="k">false</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>All tests are discovered and I&#8217;m quite happy that I can use BDD, XUnit and Resharper in combination :-) One thing to be aware
of: In order to get the tests not only discovered but also executed in Resharper you&#8217;ll have make sure that your test project and the Resharper
addin are both using the same, exact version of xUnit. I stumbled over this after I recompiled and installed my patch on my machine. Resharper
is not able to execute the tests in case of a version mismatch.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/08/29/poor-mans-dependency-injection/">Poor Mans Dependency Injection</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2008-08-29T11:02:08+02:00" pubdate  data-updated="true" >Aug 29<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>While watching the first of JP Boodhoos screencast series I discovered that a concept that I used in order to introduce testing to developers
who work mostly in legacy code (I&#8217;m using Michael Feathers terminology here) is in fact a well known pattern. Let me give you an example.
You&#8217;ve got a class that you want test, but this class somehow depends on an untestable resource like for instance a webservice. You don&#8217;t have
some kind of dependency inversion to you&#8217;re hand and have to solve this problem on your own.
A short example:</p>

<figure class='code'><figcaption><span>An example</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">BillingService</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="n">BillingResult</span> <span class="nf">DoBilling</span><span class="p">(</span><span class="n">BillingData</span> <span class="n">data</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">Bill</span> <span class="n">theBill</span> <span class="p">=</span> <span class="n">MakeBill</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">using</span><span class="p">(</span><span class="n">BillingClient</span> <span class="n">wc</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BillingClient</span><span class="p">())</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">wc</span><span class="p">.</span><span class="n">DoBilling</span><span class="p">(</span><span class="n">theBill</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>What I mostly recommend in such a situation is</p>

<ol>
<li>Extract or isolate the ugly (Quote from Jeremy Miller) which is the webservice call here.</li>
<li>Introduce an interface that shields the class from the webservice call.</li>
<li>Make the whole class rely on the abstraction.</li>
<li>Use two constructors. I mostly reffered to them as the opened and the closed constructor.</li>
</ol>


<figure class='code'><figcaption><span>The refactored BillingService</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">BillingService</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">IBillingSystem</span> <span class="n">_BillingSystem</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="nf">BillingService</span><span class="p">(</span><span class="n">IBillingSystem</span> <span class="n">billingSystem</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_BillingSystem</span> <span class="p">=</span> <span class="n">billingSystem</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">public</span> <span class="nf">BillingSystem</span><span class="p">()</span> <span class="p">:</span> <span class="k">this</span><span class="p">(</span><span class="k">new</span> <span class="n">BillingSystem</span><span class="p">())</span>
</span><span class='line'>  <span class="p">{</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="n">BillingResult</span> <span class="nf">DoBilling</span><span class="p">(</span><span class="n">BillingData</span> <span class="n">data</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">Bill</span> <span class="n">theBill</span> <span class="p">=</span> <span class="n">MakeBill</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
</span><span class='line'>      <span class="n">_BillingSystem</span><span class="p">.</span><span class="n">DoBilling</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">interface</span> <span class="n">IBillingSystem</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">void</span> <span class="nf">DoBilling</span><span class="p">(</span><span class="n">Bill</span> <span class="n">theBill</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">BillingSystem</span> <span class="p">:</span> <span class="n">IBillingSystem</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">DoBilling</span><span class="p">(</span><span class="n">Bill</span> <span class="n">theBill</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">using</span><span class="p">(</span><span class="n">BillingClient</span> <span class="n">wc</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BillingClient</span><span class="p">())</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">wc</span><span class="p">.</span><span class="n">DoBilling</span><span class="p">(</span><span class="n">theBill</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>With that you can easily replace the untestable code with some kind of testdouble like a stub or a mock.</p>

<figure class='code'><figcaption><span>The ugly dependencies in a test replaced</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">BillingServiceTest</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="na"> [Fact]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">DoBilling_ValidBill_BillIsCorrectlySendToBillingSystem</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">BillingSystemStub</span> <span class="n">billingSystem</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BillingSystemStub</span><span class="p">();</span> <span class="c1">//Replace dependency with a stub</span>
</span><span class='line'>      <span class="n">BillingService</span> <span class="n">billingService</span> <span class="p">=</span> <span class="k">new</span> <span class="n">BillingService</span><span class="p">(</span><span class="n">billingSystem</span><span class="p">);</span>
</span><span class='line'>      <span class="n">BillingData</span> <span class="n">billingData</span> <span class="p">=</span> <span class="n">MakeValidBillingData</span><span class="p">();</span>
</span><span class='line'>      <span class="n">billingService</span><span class="p">.</span><span class="n">DoBilling</span><span class="p">(</span><span class="n">billingData</span><span class="p">);</span> <span class="c1">//Do some assertions</span>
</span><span class='line'>      <span class="n">Assert</span><span class="p">.</span><span class="n">NotNull</span><span class="p">(</span><span class="n">billingSystem</span><span class="p">.</span><span class="n">RecievedBill</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Today I learned that this is also called <code>POOR MANS DEPENDENCY INJECTION</code>.</p>

<p>P.S.:
Mabe the example is not the best one but I didn&#8217;t want to go into
something like Foo and Bar again. Besides that it&#8217;s only a simplified
example. Consider that before throwing eggs and tomatos at me :-).</p>

<p>P.S.2: An alternative to this approach which doesn&#8217;t require a new interface is &#8220;Extract &amp; Override&#8221;.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/08/28/bdd-with-xunit/">BDD With Xunit</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2008-08-28T11:53:06+02:00" pubdate  data-updated="true" >Aug 28<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>My current tool of interest is XUnit. For those of you who haven&#8217;t heard
of it it&#8217;s a relatively new unit testing framework from Brad Wilson and
the original author of NUnit 2.0, James Newkirk. You can find it <a href="http://www.codeplex.com/xunit">here</a>. Some of the things I really like
about it:</p>

<ul>
<li>It has a set of .NET 3.0 Extension methods, which can be used
instead of classic assertions (f.e.:  <code>"Foo".ShouldNotBeNull()</code> )</li>
<li>It runs every every test on a separated instance.</li>
<li>It uses the constructor of the test class and the <code>Dispose</code>-pattern
for fixture initialization and release of resources after a test.</li>
<li>It&#8217;s relatively easy to extend XUnit.</li>
</ul>


<p>Because of curiosity and my current affection with BDD I decided to port
the BDDExtension stuff from JP Boodhoo to XUnit.
So here we go:</p>

<h2>Marking specifications with concerns </h2>

<p>All specifications for a particular type are marked with the <code>ConcernAttribute</code>.
This is only a marker attribute by which a tool like <code>bddunit</code>is able to correlate
specifications and their related type.</p>

<figure class='code'><figcaption><span>The ConcernAttribute</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[AttributeUsage(AttributeTargets.Class, AllowMultiple = false, Inherited = false)]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ConcernAttribute</span> <span class="p">:</span> <span class="n">TraitAttribute</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">readonly</span> <span class="n">Type</span> <span class="n">_Type</span><span class="p">;</span>
</span><span class='line'>  <span class="k">public</span> <span class="nf">ConcernAttribute</span><span class="p">(</span><span class="n">Type</span> <span class="n">type</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="s">&quot;Concern&quot;</span><span class="p">,</span> <span class="n">type</span><span class="p">.</span><span class="n">FullName</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_Type</span> <span class="p">=</span> <span class="n">type</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">public</span> <span class="n">Type</span> <span class="n">Type</span> <span class="p">{</span> <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_Type</span><span class="p">;</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The <code>ConcernAttibute</code> extends the <code>TraitAttribute</code> which is described in the documentation as</p>

<blockquote><p>an Attribute used to decorate a test method with arbitrary name/value pairs.</p></blockquote>


<p>I changed the <code>AttributeTarget</code>from method to class in order to suit my needs.</p>

<h2>Changing the way the test is executed</h2>

<p>JP&#8217;s original code relied on the <code>SetUp</code> and <code>Teaddown</code> handlers of NUnit / MBUnit which are execute before and
after each test method in the same class. Since XUnit doesn&#8217;t have that feature any more we&#8217;ll have to
extend it a bit.</p>

<p>The main extension point for how a test is executed is the <code>FactAttibute</code>used to mark a method as a test.
You can extend it and return a different <code>ITestCommand</code> which is then used to execute the test.</p>

<figure class='code'><figcaption><span>The ObservationAttribute</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ObservationAttribute</span> <span class="p">:</span> <span class="n">FactAttribute</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">ITestCommand</span><span class="p">&gt;</span> <span class="n">EnumerateTestCommands</span><span class="p">(</span><span class="n">MethodInfo</span> <span class="n">method</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">var</span> <span class="n">testCommand</span> <span class="p">=</span> <span class="k">base</span><span class="p">.</span><span class="n">EnumerateTestCommands</span><span class="p">(</span><span class="n">method</span><span class="p">).</span><span class="n">First</span><span class="p">();</span>
</span><span class='line'>      <span class="k">yield</span> <span class="k">return</span> <span class="k">new</span> <span class="nf">SpecificationTestCommand</span><span class="p">(</span><span class="n">testCommand</span><span class="p">,</span> <span class="n">method</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Do you wonder why the method returns an <code>IEnumerable&lt;ITestCommand&gt;</code>? This is
done in order to support something like row tests in MBUnit. The XUnit framework basically enables you to run a test several times.
For me this isn&#8217;t interesting so I just grabbed the first <code>ITestCommand</code> from it and wrapped it with my own implementation,
which looks like this:</p>

<figure class='code'><figcaption><span>The SpecificationCommand</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">SpecificationTestCommand</span> <span class="p">:</span> <span class="n">BeforeAfterCommand</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="nf">SpecificationTestCommand</span><span class="p">(</span><span class="n">ITestCommand</span> <span class="n">innerCommand</span><span class="p">,</span> <span class="n">MethodInfo</span> <span class="n">testMethod</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">innerCommand</span><span class="p">,</span> <span class="n">testMethod</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">override</span> <span class="n">MethodResult</span> <span class="nf">Execute</span><span class="p">(</span><span class="kt">object</span> <span class="n">testClass</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">var</span> <span class="n">specification</span> <span class="p">=</span> <span class="n">testClass</span> <span class="k">as</span> <span class="n">IContextSpecification</span><span class="p">;</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">specification</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span><span class="s">&quot;Instance does not implement IContextSpecification&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">try</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">specification</span><span class="p">.</span><span class="n">EstablishContext</span><span class="p">();</span>
</span><span class='line'>          <span class="n">specification</span><span class="p">.</span><span class="n">Because</span><span class="p">();</span>
</span><span class='line'>          <span class="k">return</span> <span class="k">base</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">testClass</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">catch</span><span class="p">(</span><span class="n">AssertException</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">throw</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">exception</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">ExceptionUtility</span><span class="p">.</span><span class="n">RethrowWithNoStackTraceLoss</span><span class="p">(</span><span class="n">exception</span><span class="p">.</span><span class="n">InnerException</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">return</span> <span class="k">null</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The code requires the test class to implement the <code>IContextSpecification</code> interface in
order to invoke the <code>EstablishContext()</code> and <code>Because()</code> methods for doing AAA based tests.
(Do you miss <code>AfterEachSpec</code>? One moment please :-))</p>

<p>For every interface there is a base class which is in my case the <code>ContextSpecification</code> class.</p>

<figure class='code'><figcaption><span>A specification base class</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">ContextSpecification</span> <span class="p">:</span> <span class="n">IContextSpecification</span><span class="p">,</span> <span class="n">IDisposable</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">Because</span><span class="p">();</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">EstablishContext</span><span class="p">();</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">AfterEachSpec</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cp">#region IContextSpecification Members </span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">void</span> <span class="n">IContextSpecification</span><span class="p">.</span><span class="n">Because</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">Because</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">void</span> <span class="n">IContextSpecification</span><span class="p">.</span><span class="n">EstablishContext</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">EstablishContext</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="cp">#endregion </span>
</span><span class='line'>
</span><span class='line'>  <span class="cp">#region IDisposable Members public</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">void</span> <span class="n">IDisposable</span><span class="p">.</span><span class="n">Dispose</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">AfterEachSpec</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="cp">#endregion </span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>
Notice some things. <code>AfterEachSpec()</code> is called from <code>Dispose()</code>, That&#8217;s why I
didn&#8217;t need to include it into the <code>IContextSpecification</code> interface.
That interface is implemented explicitly in order to allow the hooks to
have different modifiers (protected).</p>

<h2>Putting it all together</h2>

<p>There&#8217;s always an interesting moment when you first run your little experiment. Here we
go:</p>

<figure class='code'><figcaption><span>The first spec</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[Concern(typeof(Factory))]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">When_creating_product_with_a_valid_name</span> <span class="p">:</span> <span class="n">ContextSpecification</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">Factory</span> <span class="n">_Factory</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">Product</span> <span class="n">_CreatedProduct</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">EstablishContext</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_Factory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Factory</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Because</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_CreatedProduct</span> <span class="p">=</span> <span class="n">_Factory</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">&quot;Foo&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Observation]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">The_product_should_contain_the_correct_name</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_CreatedProduct</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">ShouldEqual</span><span class="p">(</span><span class="s">&quot;Foo&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Observation]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">The_product_should_contain_the_correct_vendor_name</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_CreatedProduct</span><span class="p">.</span><span class="n">VendorName</span><span class="p">.</span><span class="n">ShouldEqual</span><span class="p">(</span><span class="s">&quot;FooVendor&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And the result from TestDriven.NET is:
&#8212;&#8212; Test started:
Assembly: Xunit.BddExtensions.Samples.dll
&#8212;&#8212; 2 passed, 0 failed, 0 skipped, took 0,92 seconds.</p>

<h2>Conclusions</h2>

<p>It&#8217;s in fact very easy to extend XUnit. I like the tool even more after doing this little research.
The shown code runs smoothly with TestDriven.NET. However the Resharper - TestRunner seems to have problems with it (TestExplorer stays blank).
I&#8217;ll play with that approach in the next few weeks and will blog about my experience with both XUnit and BDD. So if you&#8217;re interested in more
stay tuned &#8230;</p>

<p>P.s.: If you&#8217;re interested in the code, just drop me a line &#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/08/27/first-steps-with-bdd/">First Steps With BDD</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2008-08-27T13:35:06+02:00" pubdate  data-updated="true" >Aug 27<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>One of the positive things of being ill and staying at home is having
time to look into stuff I always wanted to look into but never actually
had the time to. A good example for this is Behavior Driven Development
or in short BDD. BDD is described by its creator Dan North as an
enhancement to classic TDD with an emphasis on behavior specifications.
It tries to provide business value by using classes and methods written
as human readable sentences which can be reflected in order to generate
a behavior specification document for the classes under test. The
document can fulfill multiple purposes. It could be used as
documentation for the tested system and even more important as an
enabler for the ubiquitous language of the project (in terms of Evans
DDD).</p>

<p>Before looking at something more concrete about BDD, first a brief
history of my personal experience with testing throughout the last 3
years. I think this helps me to clarify, why I liked BDD from the moment
I started reading about it. My first unit tests looked very much like a
lot of tests I&#8217;ve seen from a lot of people starting with unit tests
since. (The examples are using the NUnit syntax but you can project this
to any unit testing framework you want.)</p>

<h2>Every fresh start is hard.</h2>

<figure class='code'><figcaption><span>Unstructured tests</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[TestFixture]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">FactoryTest</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">Factory</span> <span class="n">_Factory</span><span class="p">;</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [SetUp]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">SetUp</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_Factory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Factory</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Test]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">Test1</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">SomeProduct</span> <span class="n">product</span> <span class="p">=</span> <span class="n">_Factory</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">&quot;FooProduct&quot;</span><span class="p">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">Assert</span><span class="p">.</span><span class="n">IsNotNull</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
</span><span class='line'>      <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="s">&quot;FooProduct&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="n">Vendor</span><span class="p">,</span> <span class="s">&quot;Foo&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Test]</span>
</span><span class='line'><span class="na"> [ExpectedException(typeof(ArgumentNullException))]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">Test2</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_Factory</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>For every class I wanted to test I wrote a corresponding test class,
which had the suffix &#8220;Test&#8221; and contained all tests for that class under test.
I discovered later that this is a testing strategy known as <code>TEST-CASE-CLASS-PER-CLASS</code>
while reading &#8220;XUnit Test Patterns&#8221; by Gerard Meszaros. At that time it felt pretty confident with what I did. I mean, I wrote tested code, which was
to a particular degree bug free. Yeah right, but let&#8217;s have a look at the downside of what I was doing:</p>

<ul>
<li>When such a test failed I didn&#8217;t have a clue what the test was actually verifying. I had to debug the testcode.</li>
<li>When a test like <code>Test1</code> failed I didn&#8217;t know what assertion was broken. I had to debug the testcode.</li>
<li>It didn&#8217;t scale well. I became quite messy and unclear as the number of tests increased.</li>
<li>I always hat a hard time coming back to the test after having spend days in a different topic.</li>
</ul>


<h2>Incorporating a standard naming scheme for tests</h2>

<p>As one result of the observed problems I incorporated a standard naming scheme (inspired by a post of Roy Osherove)
to my tests which followed the following scheme: <code>MethodName_Scenario_Behavior</code>.
Applied to the sample code it would look like this:</p>

<figure class='code'><figcaption><span>Applying a name scheme</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[TestFixture]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">FactoryTest</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">Factory</span> <span class="n">_Factory</span><span class="p">;</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [SetUp]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">SetUp</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_Factory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Factory</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Test]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">Create_ValidCreationData_CreatesAValidProduct</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">SomeProduct</span> <span class="n">product</span> <span class="p">=</span> <span class="n">_Factory</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">&quot;FooProduct&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">Assert</span><span class="p">.</span><span class="n">IsNotNull</span><span class="p">(</span><span class="n">product</span><span class="p">);</span>
</span><span class='line'>      <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="s">&quot;FooProduct&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="n">Vendor</span><span class="p">,</span> <span class="s">&quot;Foo&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Test]</span>
</span><span class='line'><span class="na"> [ExpectedException(typeof(ArgumentNullException))]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">Create_NullForArgument_ThrowsArgumentNullException</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_Factory</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The naming scheme helped me a lot for maintaining my tests. When a test failed I knew instantly a)
which class was tested, b) what the test scenario was and c) what the expected behavior was, that was broken. However, the problem with the
multiple assertions still existed. You can fix this issue by providing error messages with every assertion. I must admit that I never really
liked that approach. I would rather go down the <code>SINGLE-ASSERTION-PER-TEST-METHOD</code> way.</p>

<p>This way you have the behavior of the class under test completely discoverable by a unit test framework
which is something I appreciate. (Maybe I&#8217;m alone with this. Several members of my team disagree with this.)</p>

<h2>Single Assertion per Test</h2>

<p>After refactoring the test it would look like this:</p>

<figure class='code'><figcaption><span>Adding single assertions per test</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[TestFixture]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">FactoryTest</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">Factory</span> <span class="n">_Factory</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="na"> [SetUp]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">SetUp</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_Factory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Factory</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Test]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">Create_ValidCreationData_CreatedProductHasName</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">SomeProduct</span> <span class="n">product</span> <span class="p">=</span> <span class="n">_Factory</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">&quot;FooProduct&quot;</span><span class="p">);</span>
</span><span class='line'>      
</span><span class='line'>      <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="s">&quot;FooProduct&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Test]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">Create_ValidCreationData_CreatesProductHasNameOfVendor</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">SomeProduct</span> <span class="n">product</span> <span class="p">=</span> <span class="n">_Factory</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">&quot;FooProduct&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">product</span><span class="p">.</span><span class="n">Vendor</span><span class="p">,</span> <span class="s">&quot;Foo&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na"> [Test]</span>
</span><span class='line'><span class="na"> [ExpectedException(typeof(ArgumentNullException))]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">Create_NullForArgument_ThrowsArgumentNullException</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_Factory</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>One downside of this approach is the sudden code duplication you now have in the code. It isn&#8217;t that
big in the example but it can be in reality. You should treat test code as you&#8217;re treating production code. Don&#8217;t repeat yourself! I usually
dealt with that situation by switching the test strategy.</p>

<h2>Switching to TEST-CLASS-PER-FIXTURE</h2>

<p><code>TEST-CLASS-PER-FIXTURE</code> is again a test strategy described by Gerald Meszaros in this book &#8220;XUnit Test Patterns&#8221;.
The basic idea is that you split your test classes into several test classes based on the common initialization / execution logic the methods share.
Applied to the sample code this would result in this:</p>

<figure class='code'><figcaption><span>Applying Test case class per fixture</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[TestFixture]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">FactoryTest_ArgumentTests</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">Factory</span> <span class="n">_Factory</span><span class="p">;</span>
</span><span class='line'><span class="na"> [SetUp]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">SetUp</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_Factory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Factory</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Test]</span>
</span><span class='line'><span class="na"> [ExpectedException(typeof(ArgumentNullException))]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">Create_NullForArgument_ThrowsArgumentNullException</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_Factory</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">[TestFixture]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">FactoryTest_CreatingAValidProduct</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">Factory</span> <span class="n">_Factory</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">SomeProduct</span> <span class="n">_Product</span><span class="p">;</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [SetUp]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">SetUp</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_Factory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Factory</span><span class="p">();</span>
</span><span class='line'>      <span class="n">_Product</span> <span class="p">=</span> <span class="n">_Factory</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">&quot;FooProduct&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Test]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">Create_ValidCreationData_CreatedProductHasName</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">_Product</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="s">&quot;FooProduct&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na"> [Test]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">Create_ValidCreationData_CreatesProductHasNameOfVendor</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">_Product</span><span class="p">.</span><span class="n">Vendor</span><span class="p">,</span> <span class="s">&quot;Foo&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&#8217;ve worked with that approach for 2 years now. It suited my needs very well.
However the tests are often not as expressive as I like them to be in terms of the naming.
I&#8217;ll guess there&#8217;s a better naming scheme when using something like the <code>TEST-CASE-CLASS-PER-FIXTURE</code> testing strategy
and that&#8217;s where the circle closes for me.</p>

<h2>Coming back to BDD </h2>

<p>While working through the preparation material for JP Boodhoos Nothing but .NET bootcamp I
made first contact with his style of applying BDD. I must admit that I&#8217;m pretty amazed,
because I&#8217;ve seen a lot of things of value for me. Sometimes sourcecode says more than
a thousand words, so this is what the sample would look like if his BDD conventions have been
applied to it:</p>

<figure class='code'><figcaption><span>The same tests context specification style</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[Concern(typeof (Factory))]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">When_creating_a_valid_product</span> <span class="p">:</span> <span class="n">ContextSpecification</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">Factory</span> <span class="n">_Factory</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">Product</span> <span class="n">_CreatedProduct</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">establish_context</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_Factory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Factory</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">because</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_CreatedProduct</span> <span class="p">=</span> <span class="n">_Factory</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="s">&quot;Foo&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Observation]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">the_product_should_contain_the_correct_product_name</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_CreatedProduct</span><span class="p">.</span><span class="n">Name</span><span class="p">.</span><span class="n">should_be_equal_to</span><span class="p">(</span><span class="s">&quot;FooProduct&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na"> [Observation]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">the_product_should_contain_the_correct_vendor_name</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_CreatedProduct</span><span class="p">.</span><span class="n">Vendor</span><span class="p">.</span><span class="n">should_be_equal_to</span><span class="p">(</span><span class="s">&quot;Foo&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">[Concern(typeof(Factory))]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">When_passing_null_for_product_name</span> <span class="p">:</span> <span class="n">ContextSpecification</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">Factory</span> <span class="n">_Factory</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">Action</span> <span class="n">_Call</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">establish_context</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_Factory</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Factory</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">because</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_Call</span> <span class="p">=</span> <span class="n">The</span><span class="p">.</span><span class="n">Action</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">_Factory</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="k">null</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na"> [Observation]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">should_throw_an_ArgumentNullException</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">_Call</span><span class="p">.</span><span class="n">should_throw_an</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>
Here is the base class that provides the hooks for the unit test framework (in this case MbUnit).</p>

<figure class='code'><figcaption><span>The ContextSpecification base class</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">using</span> <span class="nn">MbUnit.Framework</span><span class="p">;</span>
</span><span class='line'><span class="k">using</span> <span class="nn">Context</span> <span class="p">=</span> <span class="n">MbUnit</span><span class="p">.</span><span class="n">Framework</span><span class="p">.</span><span class="n">TestFixtureAttribute</span><span class="p">;</span>
</span><span class='line'><span class="k">namespace</span> <span class="nn">NothinButDotNetPrep.SpecHelpers</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="na"> [Context]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">ContextSpecification</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'><span class="na">     [SetUp]</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">void</span> <span class="nf">setup</span><span class="p">()</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">establish_context</span><span class="p">();</span>
</span><span class='line'>          <span class="n">because</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'><span class="na">     </span>
</span><span class='line'><span class="na">     [TearDown]</span>
</span><span class='line'>      <span class="k">public</span> <span class="k">void</span> <span class="nf">teardown</span><span class="p">()</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="n">after_each_specification</span><span class="p">();</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">protected</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">because</span><span class="p">();</span>
</span><span class='line'>      <span class="k">protected</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">establish_context</span><span class="p">();</span>
</span><span class='line'>      <span class="k">protected</span> <span class="k">virtual</span> <span class="k">void</span> <span class="nf">after_each_specification</span><span class="p">()</span> <span class="p">{</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>I like his way to implement the AAA (arrange, act and assert) pattern with the template
method pattern and C# 3.0 extension method for the actual assertions very much. It feels like a natural progression to what I&#8217;ve been doing
previously with a lot better readability. Another interesting thing is that he uses a tool called <code>bddunit</code> to generate a behavior
documentation from the tests. A generated documentation would look like this:</p>

<p>Behavior of Factory</p>

<ul>
<li><p>When creating a valid product</p>

<ul>
<li>the product should contain the correct vendor name.</li>
<li>the product should contain the correct product name.</li>
</ul>
</li>
<li><p>When passing null for product name</p>

<ul>
<li>should throw an ArgumentNullException</li>
</ul>
</li>
</ul>


<p>I&#8217;ll definitely have to dig more into this. If you&#8217;re interested in
learning more about BDD here are some links I&#8217;ve read this morning.</p>

<ul>
<li>Dan North: <a href="http://dannorth.net/introducing-bdd">Introducing BDD</a>.</li>
<li>AgileJoe: <a href="http://www.lostechies.com/blogs/joe_ocampo/archive/2007/08/07/attempting-to-demystify-behavior-driven-development.aspx">Attempting to demyistify BDD</a>.</li>
<li>JP: Bodhoo: <a href="http://codebetter.com/blogs/jean-paul_boodhoo/archive/2007/11/29/getting-started-with-bdd-style-context-specification-base-na.aspx">Getting started with BDD style Context / Specification base naming</a>.</li>
<li>Jimmy Bogard: <a href="http://grabbagoft.blogspot.com/2008/01/converting-tests-to-specs-is-bad-idea.html">Converting tests into specs is a bad idea</a>.</li>
<li>David Laribee: <a href="http://codebetter.com/blogs/david_laribee/archive/2007/12/17/approaching-bdd.aspx">Approaching BDD.</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/08/26/meet-the-vimperator/">Meet the Vimperator</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2008-08-26T20:14:02+02:00" pubdate  data-updated="true" >Aug 26<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Do you know the Vimperator add-in for Firefox? I didn&#8217; t at least until today. It&#8217;s an amazing piece of software that lets you control the
browser completely by keyboard with the control scheme known from the famous VI editor. It&#8217;s an open source project and can be found
<a href="http://vimperator.mozdev.org">here</a>. I haven&#8217;t had the &#8216;pleasure&#8217; to work with VI in the past, so the start was a bit hard for me. But after
half an hour fighting to the documentation and playing with the control scheme it feels really easy. Here is a list of commands I currently use
(and obviously need to remember :-)):</p>

<ul>
<li>:open url, opens the link in the current tab. (f.e.: :open bjro.de)</li>
<li>:tabopen url, opens the link in a new tab. (f.e.: :tabopen bjro.de)</li>
<li>:tabd for duplicating the current tab</li>
<li>ctrl + i , to go back in the browser history</li>
<li>ctrl + o, to forward in the browser history</li>
<li>:q for closing the current tab.</li>
<li>strg+p for switching to the previous tab.</li>
<li>strg+n for switching to the next tab.</li>
<li>f for highlighting all links in the document. Typing the link number
will navigate to that link in the same page.</li>
<li>F for highlighting all links in the document. Typing the link number
will navigate to that link in a new tab.</li>
<li>:bmark for bookmarking the currently displayed page-</li>
<li>:bmarks for showing a list of all bookmarks.</li>
<li>j for scrolling down.</li>
<li>k for scrolling up.</li>
<li>h for scrolling left.</li>
<li>l for scrolling right.</li>
</ul>


<p>Give the tool a try. It&#8217;s really fun &#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/08/22/ambient-transactions-and-nhibernate/">Ambient Transactions and NHibernate</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2008-08-22T17:29:30+02:00" pubdate  data-updated="true" >Aug 22<span>nd</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>About two weeks ago we had some discussions in the german Alt.NET mailing list whether ambient transactions can be used in combination
with NHibernate, especially regarding performance implications of such an approach. Background of that discussion was that my colleague
<a href="http://shishkin.org">Sergey</a> and I wanted to implement the repository pattern based on Linq 2 NHibernate in a way that exposes no NHibernate
dependency to a surrounding layer. Besides that we didn&#8217;t want to dublicate the UnitOfWork pattern that NHibernate implements internally.
Because of that we decided to try out ambient transactions (<code>System.Transactions</code>) as our UnitOfWork. Sergey has already posted about
the design we&#8217;re currently investigating, so I won&#8217;t go into detail about that here. You can read more here:</p>

<ul>
<li><a href="http://sergeyshishkin.spaces.live.com/blog/cns!9F19E53BA9C1D63F!263.entry">Repository Pattern revised</a></li>
<li><a href="http://sergeyshishkin.spaces.live.com/blog/cns!9F19E53BA9C1D63F!265.entry">UnitOfWork Pattern revised</a></li>
<li><a href="http://sergeyshishkin.spaces.live.com/blog/cns!9F19E53BA9C1D63F!264.entry">Specification Pattern revised</a></li>
</ul>


<p>We started with a simple test comparison between the behavior of <code>NHibernates</code> native <code>ITransactions</code> and NHibernate using
<code>TransactionScope</code> for transactions. What we noticed :</p>

<h2>FlushMode.Commit doesn&#8217;t work when using ambient Transactions</h2>

<p>The following (xUnit) test fails:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[Fact]</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">Session_should_be_clean_after_commited_transaction</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">tx</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TransactionScope</span><span class="p">())</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">SaveTwoPatients</span><span class="p">();</span>
</span><span class='line'>      <span class="n">tx</span><span class="p">.</span><span class="n">Complete</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Session</span><span class="p">.</span><span class="n">IsDirty</span><span class="p">().</span><span class="n">ShouldBeFalse</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>But this can be easily fixed like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[Fact]</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">Session_should_be_clean_after_commited_transaction_Fixed</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">using</span> <span class="p">(</span><span class="n">var</span> <span class="n">tx</span> <span class="p">=</span> <span class="k">new</span> <span class="n">TransactionScope</span><span class="p">())</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>          <span class="n">Transaction</span><span class="p">.</span><span class="n">Current</span><span class="p">.</span><span class="n">TransactionCompleted</span> <span class="p">+=</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span> <span class="p">=&gt;</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="n">Transaction</span><span class="p">.</span><span class="n">TransactionInformation</span><span class="p">.</span><span class="n">Status</span> <span class="p">==</span> <span class="n">TransactionStatus</span><span class="p">.</span><span class="n">Committed</span><span class="p">)</span>
</span><span class='line'>              <span class="p">{</span>
</span><span class='line'>                  <span class="n">Session</span><span class="p">.</span><span class="n">Flush</span><span class="p">();</span>
</span><span class='line'>                  <span class="n">Session</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>          <span class="p">};</span>
</span><span class='line'>          
</span><span class='line'>          <span class="n">SaveTwoPatients</span><span class="p">();</span>
</span><span class='line'>          <span class="n">tx</span><span class="p">.</span><span class="n">Complete</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="n">Session</span><span class="p">.</span><span class="n">IsDirty</span><span class="p">().</span><span class="n">ShouldBeFalse</span><span class="p">();</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>For some reason ambient Transaction are FASTER than NHibernates native counter parts</h2>

<p>We have also some tests that perform a transactional insert a 1000 times. The duration of those tests are
quite surprising. Have a look:</p>

<p><a href="/images/posts/nhibernatetransactions.png" title="NHibernate transactions"><img src="/images/posts/nhibernatetransactions.png" alt="NHibernateTransactions" /></a></p>

<p>This has nothing to do with jitting in the CLR or the order how test are executed. I double checked the durations and ran each test on his own.
I didn&#8217;t expect that gap, but I&#8217;m also not a NHibernate pro. Any thoughts? I&#8217;ll write more about our experiences with that approach soon.
Our concept looks good on paper and our first impressions are not disproving either, so stay tuned &#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/08/19/some-words-regarding-mstest/">Some Words Regarding MSTest</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2008-08-19T21:41:50+02:00" pubdate  data-updated="true" >Aug 19<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I stumbled again about this and feel (once more) a bit frustrated about the current version of <code>MSTest</code>. In theory <code>Visual Studio VS2008</code>
supports Test-Class-Inheritance. Once you actually start using it, you pretty fast encounter one big limitation:</p>

<h2>The test base class must be in the same assembly as the derived test</h2>

<p>Mh, is that such an uncommon scenario that it&#8217;s not supported? Personally I don&#8217;t think so. What about context specification extensions for <code>MSTest</code>?
Do I need to have a <code>Specification</code> base class in each test assembly? Oh, c&#8217;mon ?!</p>

<p>Just when you think it can&#8217;t get worse, you realize that</p>

<h2>Tests using Test-Class-Inheritance are NOT EXECUTED when running inside a VS TFS 2008 TeamBuild</h2>

<p>Awesome :-( Besides that, we also still have the <code>*.vsmdi-hell</code> (Replace * with the
name your Solution and a number between 1 and 100 &#8230;), but that a different story.</p>

<p>If it was my personal decision I would ditch <code>MSTest</code> right away. It&#8217;ll be interesting to see whether I&#8217;m able to convince our
development leads to go down that road &#8230;</p>
</div>
  
  


    </article>
  
  <nav class="pagination">
    <div>
      
        <a class="prev" href="/blog/page/9/">&larr; Older</a>
      
      <a href="/blog/archives">Blog Archives</a>
      
      <a class="next" href="/blog/page/7/">Newer &rarr;</a>
      
    </div>
  </nav>
</div>
<aside class="sidebar">
  
    <section>
	<h1>About me</h1>
  <p><br/><img src="/images/bjro-eyes.jpg" alt="portrait" /></p>
	<p>
  My name is <strong>BjÃ¶rn Rochel</strong>.  I&#8217;m a 32 year old geek, who&#8217;s crazy about software development, living in Cologne and
  currently working for <a href="http://www.intercomponentware.com">ICW</a> as a Developer / Architect.
	</p>
	<ul id="badges">
    <li><a id="xing" href="http://www.xing.com/profile/Bjoern_Rochel"><span>XING</span></a></li>
    <li><a id="github" href="http://www.github.com/BjRo"><span>Github</span></a></li>
    <li><a id="twitter" href="http://www.twitter.com/bjoernrochel"><span>Twitter</span></a></li>
    <li><a id="rss" href="/atom.xml"><span>Rss</span></a></li>
	</ul>
</section>

<section>
  <h1>Categories</h1>
  <ul id='categories'>
<li><a href='http://www.bjoernrochel.de/blog/categories/Conferences/'>Conferences (8)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/FSharp/'>FSharp (3)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/Katas/'>Katas (2)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/StoryTeller/'>StoryTeller (14)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/StructureMap/'>StructureMap (9)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/Testing/'>Testing (20)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/Uncategorized/'>Uncategorized (8)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/dotnet/'>dotnet (65)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/ruby/'>ruby (3)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/sw-design/'>sw-design (13)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/xUnitBDDExtensions/'>xUnitBDDExtensions (15)</a></li>
</ul>

</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("bjoernrochel", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/bjoernrochel" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @bjoernrochel</a>
  
</section>

<section>
<h1>Disclaimer</h1>
<p>
The opinions expressed herein are my own personal opinions and do not necessarily represent the opinion of any other organization or person, including (but not limited to) my fellow employees, my employer, its clients or their agents. 
</p>
<p>
 Copyright &copy; 2011 - BjÃ¶rn Rochel
</p>
<section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - BjÃ¶rn Rochel -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'bjro';
      
        
        var disqus_script = 'count.js';
      

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>







</body>
</html>
