
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Dude, where's my Kaizen?</title>
  <meta name="author" content="Björn Rochel">

  
  <meta name="description" content="Today I added this little piece of code to the trunk of xUnit.BDDExtensions. It&#8217;s a rake task for merging assemblies via the ILMerge tool. &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.bjoernrochel.de/blog/page/6/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Dude, where's my Kaizen?" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <header role="banner"><div id="logo">
</div>
<hgroup>
  <h1><a href="/">Dude, where's my Kaizen?</a></h1>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.bjoernrochel.de" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/01/27/ilmerge-and-rake-go-xunitbddextensions/">ILMerge and Rake Go xunit.BDDExtensions</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2009-01-27T14:48:54+01:00" pubdate  data-updated="true" >Jan 27<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I added this little piece of code to the trunk of xUnit.BDDExtensions. It&#8217;s a rake task for merging assemblies via the ILMerge tool.</p>

<figure class='code'><figcaption><span>Merging assemblies with ILMerge</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">desc</span> <span class="s2">&quot;Merges the assemblies&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:merge</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">mkdir</span> <span class="no">DEPLOY_DIR</span> <span class="k">unless</span> <span class="no">File</span><span class="o">.</span><span class="n">exists?</span><span class="p">(</span><span class="no">DEPLOY_DIR</span><span class="p">)</span>
</span><span class='line'>  <span class="n">cp</span> <span class="s2">&quot;xunit.dll&quot;</span><span class="o">.</span><span class="n">expand_to</span><span class="p">(</span><span class="ss">:build_dir</span><span class="p">),</span> <span class="s2">&quot;xunit.dll&quot;</span><span class="o">.</span><span class="n">expand_to</span><span class="p">(</span><span class="ss">:deploy_dir</span><span class="p">)</span>
</span><span class='line'>  <span class="n">cp</span> <span class="s2">&quot;Rhino.Mocks.dll&quot;</span><span class="o">.</span><span class="n">expand_to</span><span class="p">(</span><span class="ss">:build_dir</span><span class="p">),</span> <span class="s2">&quot;Rhino.Mocks.dll&quot;</span><span class="o">.</span><span class="n">expand_to</span><span class="p">(</span><span class="ss">:deploy_dir</span><span class="p">)</span>
</span><span class='line'>  <span class="n">assemblies_to_merge</span> <span class="o">=</span> <span class="o">[</span><span class="s2">&quot;xUnit.BDDExtensions.dll&quot;</span><span class="p">,</span> <span class="s2">&quot;StructureMap.dll&quot;</span><span class="p">,</span> <span class="s2">&quot;StructureMap.AutoMocking.dll&quot;</span><span class="o">]</span>
</span><span class='line'>  <span class="n">ilmerge</span> <span class="s2">&quot;xunit.bddextensions.dll&quot;</span><span class="p">,</span> <span class="n">assemblies_to_merge</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Ruby is a fantastic language. The more I learn about it the more I actually like it. Let&#8217;s have a look at how this task is implemented.
First of all I opened up Ruby&#8217;s string class and added new methods to it (this is called MonkeyPatching, and worth a blog post on its own :-))</p>

<figure class='code'><figcaption><span>Extending the String class</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">String</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">escape</span>
</span><span class='line'>    <span class="s2">&quot;&quot;</span><span class="c1">#{self.to_s}&quot;&quot; </span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">expand_to</span> <span class="n">dir_symbol</span>
</span><span class='line'>    <span class="k">case</span> <span class="n">dir_symbol</span>
</span><span class='line'>      <span class="k">when</span> <span class="ss">:build_dir</span> <span class="n">path</span> <span class="o">=</span> <span class="no">BUILD_DIR</span>
</span><span class='line'>      <span class="k">when</span> <span class="ss">:source_dir</span> <span class="n">path</span> <span class="o">=</span> <span class="no">SOURCE_DIR</span>
</span><span class='line'>      <span class="k">when</span> <span class="ss">:externals_dir</span> <span class="n">path</span> <span class="o">=</span> <span class="no">EXTERNALS_DIR</span>
</span><span class='line'>      <span class="k">when</span> <span class="ss">:deploy_dir</span> <span class="n">path</span> <span class="o">=</span> <span class="no">DEPLOY_DIR</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="nb">self</span><span class="o">.</span><span class="n">to_s</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>And here is the actual <code>ilmerge</code> - method. It simply gets the complete path to the ILMerge.exe (not shown here), expands the name to all
assemblies that have to be merged and escapes them, before the actual call to ILMerge is issued over the console &#8230;</p>

<figure class='code'><figcaption><span>The ilmerge method</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">ilmerge</span><span class="p">(</span><span class="n">output_name</span><span class="p">,</span> <span class="n">assemblies</span><span class="p">)</span>
</span><span class='line'>  <span class="n">ilmerge</span> <span class="o">=</span> <span class="n">get_tool</span> <span class="ss">:ILMerge</span> <span class="n">expanded_assemblies</span> <span class="o">=</span> <span class="n">assemblies</span><span class="o">.</span><span class="n">map</span> <span class="k">do</span> <span class="o">|</span><span class="n">x</span><span class="o">|</span>
</span><span class='line'>    <span class="n">x</span><span class="o">.</span><span class="n">expand_to</span><span class="p">(</span><span class="ss">:build_dir</span><span class="p">)</span><span class="o">.</span><span class="n">escape</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">sh</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">ilmerge</span><span class="o">.</span><span class="n">escape</span><span class="si">}</span><span class="s2"> /out:</span><span class="si">#{</span><span class="n">output_name</span><span class="o">.</span><span class="n">expand_to</span><span class="p">(</span><span class="ss">:deploy_dir</span><span class="p">)</span><span class="o">.</span><span class="n">escape</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">expanded_assemblies</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>Currently 3 assemblies pop out of the Rake build. These are <code>xunit.dll</code>, <code>xunit.bddextensions.dll</code> and <code>Rhino.Mocks.dll</code>. While it&#8217;s technically no
problem to merge them into a single assembly (and of course I would love to have it that way) there are two problems currently not solved. The
R# runner dynamically loads the <code>xunit.dll</code> to run the tests and <code>StructureMap.AutoMocking.dll</code> dynamically loads <code>Rhino.Mocks.dll</code>. That&#8217;s
the reason why I&#8217;m currently not able to merge it.</p>

<p>Any suggestions how to solve that?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/01/26/automocking-in-xunitbddextensions/">AutoMocking in xUnit.BDDExtensions</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2009-01-26T16:33:59+01:00" pubdate  data-updated="true" >Jan 26<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><figcaption><span>Automocking in xUnit.BDDExtensions</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">when_an_automatically_resolved_instance_with_a_single_dependency_is_used_in_a_fixture</span> <span class="p">:</span> <span class="n">InstanceContextSpecification</span><span class="p">&lt;</span><span class="n">AutomaticallyCreatedInstance</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="kt">object</span> <span class="n">actualResult</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">IDependency</span> <span class="n">dependency</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="kt">object</span> <span class="n">expectedResult</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">EstablishContext</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">expectedResult</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">object</span><span class="p">();</span>
</span><span class='line'>      <span class="n">dependency</span> <span class="p">=</span> <span class="n">AutoDependency</span><span class="p">&lt;</span><span class="n">IDependency</span><span class="p">&gt;();</span>
</span><span class='line'>      <span class="n">dependency</span><span class="p">.</span><span class="n">WhenToldTo</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Invoke</span><span class="p">()).</span><span class="n">Return</span><span class="p">(</span><span class="n">expectedResult</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Because</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">actualResult</span> <span class="p">=</span> <span class="n">Sut</span><span class="p">.</span><span class="n">Invoke</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Observation]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">should_be_able_to_verify_calls_made_to_the_dependency</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">dependency</span><span class="p">.</span><span class="n">WasToldTo</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Invoke</span><span class="p">());</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Observation]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">should_execute_the_configured_behavior_on_the_dependency</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">actualResult</span><span class="p">.</span><span class="n">ShouldBeEqualTo</span><span class="p">(</span><span class="n">expectedResult</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This little feature was added to the trunk today. Yes, no CreateSut() call. You can omit it for most of the simple scenarios. You can still
override it, if you need/have to. It uses the AutoMocking capabilities of StructureMap internally.</p>

<p>I&#8217;m going to merge the different involved assemblies to a single assembly soon in order to make deployment a bit easier &#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/01/23/why-should-you/">Why Should You?</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2009-01-23T17:36:17+01:00" pubdate  data-updated="true" >Jan 23<span>rd</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>What&#8217;s the importance of <em>Should</em> in BDD? Why isn&#8217;t it called <em>Must</em>, <em>Need to</em> or <em>Will</em>? It&#8217;s one of those subtle psychological things &#8230;</p>

<p>The main reason Dan North decided to use <em>Should</em> instead of all other possibilities is, that <em>Should</em>implies that you can always question the
behavior of your system. It isn&#8217;t written in stone. If you think the system doesn&#8217;t behave correctly any more, feel free to change or drop
the particular spec.  I found this little comment of Dan North worth remembering &#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/01/23/wording-in-bdd-specs/">Wording in BDD Specs</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2009-01-23T17:26:48+01:00" pubdate  data-updated="true" >Jan 23<span>rd</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Last week I had a little discussion on the german ALT.net mailing list
in which I commented on a code example of a spec that <strong>wording in a BDD
spec is of vital importance to BDD and therefore should be chosen very
carefully</strong>. With this post I would like to clarify a bit what I meant
with that. I&#8217;d like to add that I still consider myself to be a learner
in the BDD area. So, if you see things differently, feel free to
comment. Let&#8217;s start by looking back on my own efforts with testing and
BDD. For about 2 years I wrote (what I consider to be) classical unit
tests. Those tests followed strictly a &#8221;<MethodName><em><Scenario></em><Behavior>&#8221; naming convention originally
proposed by Roy Osherove. Here&#8217;s short example of what I wrote that
time.</p>

<figure class='code'><figcaption><span>A typical unit test ala Roy Osherove naming style</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[Fact]</span>
</span><span class='line'><span class="k">public</span> <span class="k">void</span> <span class="nf">RegisterSubscriber_NewSubscriber_SubscriberIsRegistered</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">var</span> <span class="n">subscriber</span> <span class="p">=</span> <span class="k">new</span> <span class="n">FakeSubscriber</span><span class="p">();</span>
</span><span class='line'>  <span class="n">subscriptionManager</span><span class="p">.</span><span class="n">RegisterSubscriber</span><span class="p">(</span><span class="n">subsriber</span><span class="p">);</span>
</span><span class='line'>  <span class="n">var</span> <span class="n">wasRegistered</span> <span class="p">=</span> <span class="n">subscriptionManger</span><span class="p">.</span><span class="n">AllSubscriptionsFor</span><span class="p">().</span><span class="n">Contains</span><span class="p">(</span><span class="n">subscriber</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">Assert</span><span class="p">.</span><span class="n">True</span><span class="p">(</span><span class="n">wasRegistered</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>When changing my tests to a more BDD oriented style last august (if you&#8217;re interested why please
read <a href="http://www.bjoernrochel.de/2008/08/27/first-steps-with-bdd/">here</a>), my style of writing tests changed to something that looked like this.</p>

<figure class='code'><figcaption><span>Sub optimal wording </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[Concern(typeof(SubscriptionManager))]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">When_registering_a_subscriber_at_the_subscription_manager</span> <span class="p">:</span> <span class="n">InstanceContextSpecification</span><span class="p">&lt;</span><span class="n">SubscriptionManager</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">ISubscriber</span> <span class="n">subscriber</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">EstablishContext</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">subscriber</span> <span class="p">=</span> <span class="k">new</span> <span class="n">FakeSubscriber</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="n">SubscriptionManager</span> <span class="nf">CreateSut</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">SubscriptionManager</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Because</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">Sut</span><span class="p">.</span><span class="n">RegisterSubscriber</span><span class="p">(</span><span class="n">subscriber</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Observation]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">should_be_contained_in_the_list_of_subscriptions_for_the_subscribed_message</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">subscriptionManger</span><span class="p">.</span><span class="n">AllSubscriptionsFor</span><span class="p">().</span><span class="n">ShouldContain</span><span class="p">(</span><span class="n">subscriber</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>For me at that particular point BDD meant not much more than a bunch of proven practices in test design and a revised
naming convention. So what might be wrong with the way the spec is written here (event in that context)?</p>

<ol>
<li>It isn&#8217;t fully refactoring safe (to be fair, the classic unit test shown above wasn&#8217;t either). Try to rename the term
SubscriptionManager (or RegisterSubscriber in the first example). No refactoring tool will help you renaming your existing specs. As a
consequence I would strongly suggest <strong>not to encode type or member names into a specification</strong>.</li>
<li>It doesn describe behavior. It describes implementation. A spec should describe what a system under test is supposed to do, not how
it achives it. Do you see the word &#8220;list&#8221; here?</li>
</ol>


<p>You could revise the spec like this.</p>

<figure class='code'><figcaption><span>A revised spec</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[Concern(typeof(SubscriptionManager))]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">When_registering_a_new_subscriber</span> <span class="p">:</span> <span class="n">InstanceContextSpecification</span><span class="p">&lt;</span><span class="n">SubscriptionManager</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">ISubscriber</span> <span class="n">subscriber</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">EstablishContext</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">subscriber</span> <span class="p">=</span> <span class="k">new</span> <span class="n">FakeSubscriber</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="n">SubscriptionManager</span> <span class="nf">CreateSut</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">SubscriptionManager</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Because</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">Sut</span><span class="p">.</span><span class="n">RegisterSubscriber</span><span class="p">(</span><span class="n">subscriber</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Observation]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">should_enable_the_subscriber_to_recieve_messages_he_is_interested_in</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">subscriptionManger</span> <span class="p">.</span><span class="n">AllSubscriptionsFor</span><span class="p">()</span> <span class="p">.</span><span class="n">ShouldContain</span><span class="p">(</span><span class="n">subscriber</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Having said this, IS THAT THE REASON why I consider wording be to so important to BDD?</h2>

<p>No, not really. Nearly the same applies to classic unit testing, too. We should take a closer look at
BDD in order to reach the answer.</p>

<h2>Was the example shown above even BDD?</h2>

<p>IMHO Second no. The example isn&#8217;t BDD. It only shows a way how a part of BDD can be implemented, with a framework; be it
xunit.bddextensions, SpecUnit, MSpec or any other tool out there.</p>

<h2>hm, ok what is BDD then?</h2>

<p>As I understand it so far, BDD was originally created to codify acceptance criterias of stakeholders into executable code in a way which preseverves most/all of the vocabulary the
stakeholder uses. By that a shared language can be established between stakeholders. (Greg Young wrote a nice post about the <a href="http://codebetter.com/blogs/gregyoung/archive/2007/10/16/bdd-and-the-shared-language.aspx">subtle difference between BDDs shared language and DDDs ubiquitous
language</a>, so I won&#8217;t repeat that here). This shared language is ment to enhance
the way different parties/stakeholders interact with each other, a way to enhance communication. And what is the primary utility used in the interactions between stakeholders in BDD? ==> The executable
specifications.</p>

<h2>Coming back to why wording is so important to BDD </h2>

<p>What is especially interesting in BDD is, that as there&#8217;re different stakeholders, <a href="http://codebetter.com/blogs/aaron.jensen/archive/2008/10/19/bdd-consider-your-audience.aspx">there&#8217;re also different kind of audiences, with
possibly different kind of vocabulary</a>.Â
So because BDD specs are targeted to be an acceptance criteria, they need to be written in the vocabulary of the people who will review them.
This is a huge influence besides all the more technical reasons I touched earlier which of course are relevant, too. Does this make sense
to you?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/01/21/tales-from-hashes-null-and-boolean-evaluation/">Tales From Hashes, Null and Boolean Evaluation</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2009-01-21T17:39:15+01:00" pubdate  data-updated="true" >Jan 21<span>st</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>A common programming situation when dealing with dictionary or hashtable
classes is trying to get a value from the hashtable and returning a
default value in case nothing was found. In C# you could probably do it
like this:</p>

<figure class='code'><figcaption><span>A StringMapper </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">StringMapper</span> <span class="p">:</span> <span class="n">IMapper</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">IDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="kt">string</span><span class="p">&gt;</span> <span class="n">mapping</span><span class="p">;</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">public</span> <span class="nf">Mapper</span><span class="p">(</span><span class="n">IDictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">mapping</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">this</span><span class="p">.</span><span class="n">mapping</span> <span class="p">=</span> <span class="n">mapping</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">public</span> <span class="kt">string</span> <span class="nf">Map</span><span class="p">(</span><span class="kt">string</span> <span class="n">input</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="kt">string</span> <span class="n">output</span><span class="p">;</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">if</span><span class="p">(!</span><span class="k">this</span><span class="p">.</span><span class="n">mapping</span><span class="p">.</span><span class="n">TryGetValue</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="k">out</span> <span class="n">output</span><span class="p">))</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">return</span> <span class="s">&quot;defaultValue&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">return</span> <span class="n">output</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>You could write similar code in Ruby.</p>

<figure class='code'><figcaption><span>My first naive implementation in Ruby</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">StringMapper</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">hash_map</span><span class="p">)</span>
</span><span class='line'>      <span class="vi">@hash_map</span> <span class="o">=</span> <span class="n">hash_map</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
</span><span class='line'>      <span class="n">output</span> <span class="o">=</span> <span class="vi">@hash_map</span><span class="o">[</span><span class="n">input</span><span class="o">]</span>
</span><span class='line'>      <span class="k">return</span> <span class="p">(</span><span class="n">output</span><span class="o">.</span><span class="n">nil?</span><span class="p">)</span> <span class="p">?</span> <span class="s2">&quot;defaultValue&quot;</span> <span class="p">:</span> <span class="n">output</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>However the way the map method is written is not the way Ruby is intended to be used and how Ruby sources are
mostly written. You could rework this into this short fragment.</p>

<figure class='code'><figcaption><span>A more ideomatic solution </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">def</span> <span class="nf">map</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
</span><span class='line'>  <span class="vi">@hash_map</span><span class="o">[</span><span class="n">input</span><span class="o">]</span> <span class="ow">or</span> <span class="s2">&quot;defaultValue&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>You might yourself now ask (as I did) why this code works? It works because</p>

<ol>
<li>Ruby automatically treats the last evaluated expression inside a method as the return value. Because of that you&#8217;re able to omit the return statements.</li>
<li><code>Nil</code> (the Ruby equivalent of C#s <code>null</code> ) is actually an instance, an instance of the <code>NilClass</code>). Yeah right, you have the Null-Object-Pattern in the language here :-)</li>
<li>Every object instance can be evaluated to a boolean. Every instance other than an instance of the <code>NilClass</code> evaluates to an instance of
the <code>TrueClass</code>. The only exception to this is of course <code>false</code>.</li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/01/19/using-rake-to-automate-net-builds/">Using Rake to Automate .NET Builds</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2009-01-19T19:12:05+01:00" pubdate  data-updated="true" >Jan 19<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Today I started writing my first build scripts in Ruby for a .NET project using Rake.
This is what I came up with.</p>

<figure class='code'><figcaption><span>My fist rake script</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;rake/clean&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="no">EXTERNALS_DIR</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../Externals&#39;</span><span class="p">)</span>
</span><span class='line'><span class="no">BUILD_DIR</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../Bin&#39;</span><span class="p">)</span>
</span><span class='line'><span class="no">SOURCE_DIR</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../Source&#39;</span><span class="p">)</span>
</span><span class='line'><span class="no">CLEAN</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="no">FileList</span><span class="o">[</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">BUILD_DIR</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">desc</span> <span class="s2">&quot;Compiles the gemini sources&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:build</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gemini_solution</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">SOURCE_DIR</span><span class="p">,</span> <span class="s1">&#39;Gemini.sln&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">sh</span> <span class="s2">&quot;msbuild /property:WarningLevel=4;OutDir=</span><span class="si">#{</span><span class="no">BUILD_DIR</span><span class="si">}</span><span class="s2">/ </span><span class="si">#{</span><span class="n">gemini_solution</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">desc</span> <span class="s2">&quot;Runs all the tests on the gemini code&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:test</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">assemblies</span> <span class="o">=</span> <span class="n">all_spec_assemblies</span><span class="p">()</span>
</span><span class='line'>  <span class="n">xunit_console</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">EXTERNALS_DIR</span><span class="p">,</span> <span class="s2">&quot;xUnit/xunit.console.exe&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">assemblies</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">assembly</span><span class="o">|</span>
</span><span class='line'>      <span class="n">sh</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">xunit_console</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">assembly</span><span class="si">}</span><span class="s2"> /html </span><span class="si">#{</span><span class="n">assembly</span> <span class="o">+</span><span class="s1">&#39;.UnitTests.html&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">task</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:clean</span><span class="p">,</span> <span class="ss">:build</span><span class="p">,</span> <span class="ss">:test</span><span class="o">]</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">all_spec_assemblies</span><span class="p">()</span>
</span><span class='line'>  <span class="n">file_mask</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">BUILD_DIR</span><span class="p">,</span> <span class="s1">&#39;*Specs.dll&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="no">FileList</span><span class="o">[</span><span class="n">file_mask</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>I think this code demonstrates the qualities of Ruby as a scripting language and Rake as a build tool really well.
It&#8217;s very descriptive and even more important it doesn&#8217;t have all the xml-slash-what-the-hell-is-going-on-here-noise
around it. I know it&#8217;s a very simple solution, but I consider it a good start. Let&#8217;s look a bit more detailed at the parts of the script.</p>

<figure class='code'><figcaption><span>Defining paths </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">EXTERNALS_DIR</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../Externals&#39;</span><span class="p">)</span>
</span><span class='line'><span class="no">BUILD_DIR</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../Bin&#39;</span><span class="p">)</span>
</span><span class='line'><span class="no">SOURCE_DIR</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">expand_path</span><span class="p">(</span><span class="s1">&#39;../Source&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This part defines some directory constants that are used in the script. The rakefile is currently run from the directory &#8216;Build&#8217;
which is on the same level as &#8216;Externals&#8217;, &#8216;Bin&#8217; and &#8216;Source&#8217;. Relative paths are expanded to absolute paths here.</p>

<figure class='code'><figcaption><span>Using the built-in clean task</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">CLEAN</span><span class="o">.</span><span class="n">include</span><span class="p">(</span><span class="no">FileList</span><span class="o">[</span><span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">BUILD_DIR</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">)</span><span class="o">]</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This tiny little code piece modifies the built-in :clean task and adds all files under the BUILD_DIR to it. Running &#8216;rake clean&#8217; on the console
will now delete all files from our build directory.</p>

<figure class='code'><figcaption><span>Invoking the sources</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">desc</span> <span class="s2">&quot;Compiles the gemini sources&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:build</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">gemini_solution</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">SOURCE_DIR</span><span class="p">,</span> <span class="s1">&#39;Gemini.sln&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">sh</span> <span class="s2">&quot;msbuild /property:WarningLevel=4;OutDir=</span><span class="si">#{</span><span class="no">BUILD_DIR</span><span class="si">}</span><span class="s2">/ </span><span class="si">#{</span><span class="n">gemini_solution</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is the first task I&#8217;ve actually written on my own. It&#8217;s only a very small wrapper around msbuild that builds the
solution file.</p>

<figure class='code'><figcaption><span>running tests</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">desc</span> <span class="s2">&quot;Runs all the tests on the gemini code&quot;</span>
</span><span class='line'><span class="n">task</span> <span class="ss">:test</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">assemblies</span> <span class="o">=</span> <span class="n">all_spec_assemblies</span><span class="p">()</span>
</span><span class='line'>  <span class="n">xunit_console</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">EXTERNALS_DIR</span><span class="p">,</span> <span class="s2">&quot;xUnit/xunit.console.exe&quot;</span><span class="p">)</span>
</span><span class='line'>  <span class="n">assemblies</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">assembly</span><span class="o">|</span>
</span><span class='line'>      <span class="n">sh</span> <span class="s2">&quot;</span><span class="si">#{</span><span class="n">xunit_console</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">assembly</span><span class="si">}</span><span class="s2"> /html </span><span class="si">#{</span><span class="n">assembly</span> <span class="o">+</span><span class="s1">&#39;.UnitTests.html&#39;</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">all_spec_assemblies</span><span class="p">()</span>
</span><span class='line'>  <span class="n">file_mask</span> <span class="o">=</span> <span class="no">File</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="no">BUILD_DIR</span><span class="p">,</span> <span class="s1">&#39;*Specs.dll&#39;</span><span class="p">)</span> <span class="no">FileList</span><span class="o">[</span><span class="n">file_mask</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>That little code is a small wrapper around xUnit.net which invokes the xunit.console.exe for each file it finds in the build
directory that ends with &#8216;Spec.dll&#8217;. These are the assemblies which contain the BDD-style tests in our project.</p>

<figure class='code'><figcaption><span>Defining the default task</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">task</span> <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="o">[</span><span class="ss">:clean</span><span class="p">,</span> <span class="ss">:build</span><span class="p">,</span> <span class="ss">:test</span><span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<p>This last piece defines the :default build task. That&#8217;s the task which is run when you don&#8217;t specify a task directly when running rake from console.
This will run all tasks in the order specified from left to right.</p>

<h2>Conclusion</h2>

<p>The Rake build engine rocks !!! Its really simple and descriptive API is fun and Rake doesn&#8217;t create a lot of ceremony around build scripts (Only
around 30 lines of code in my current script). However, you should be aware of one thing: Coming from a language with a lot of IDE support
(like C# in my case) to Ruby might not be as easy as it sounds. It took me quite a while to make the transition from Intellisense and Resharper
to using IRB and reading RDoc in order to explore new APIs &#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2009/01/19/yes-im-still-alive/">Yes, I&#8217;m Still Alive &#8230;</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2009-01-19T13:06:30+01:00" pubdate  data-updated="true" >Jan 19<span>th</span>, 2009</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>First of all: Happy new year to everyone. I know, I know, I&#8217;m really late with that :-)</p>

<p>It&#8217;s been really quite on this blog for the last two month and I&#8217;m sorry for that. I&#8217;ve been busy changing a lot of things that caused me
frustration and friction in my life as a software engineer in 2008 &#8230;</p>

<p>Anyway, 2009, a new year. What&#8217;s to expect from this blog this year?</p>

<ol>
<li><strong>Ruby</strong> Following the pragmatic programmers advice I started to learn a new
language, namely Ruby. Expect to see a lot of posts around the Ruby language, the Rake buildsystem, Gems, RSpec, Ruby on Rails and
IronRuby in the future.</li>
<li><strong>Software architecture in .NET and the Ruby realm</strong>
A good, simple software design has always been one of the key aspects to successful software projects for me. This includes
testability, automation, convention-based development, reversibility, extensibility, maintainability and a lot of other
stuff. Many areas to be covered. Lots of posts to be written :-)</li>
</ol>


<p>Stay tuned for more &#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/27/a-new-syntax-for-xunitbddextensions/">A New Syntax for xUnit.BDDExtensions ???</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2008-11-27T15:21:51+01:00" pubdate  data-updated="true" >Nov 27<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I&#8217;ve been doing BDD with the &#8221;<a href="http://www.lostechies.com/blogs/colinjack/archive/2008/11/19/context-specification-available-frameworks-bdd.aspx">context/specification</a>t&#8221;-
style for about 4 months now. Examples for this style are <a href="http://codebetter.com/blogs/aaron.jensen/archive/2008/09/02/mspec-v0-2.aspx">MSpec</a>,
<a href="http://nspec.tigris.org/">NSpec</a> or my little framework called <a href="http://www.github.com/bjro/xunitbddextensions/">xUnit.BDDExtensions</a>.
What bothers me lately is that this style mixes context and behavior under test into one fixture class name, which can be extremely long
because of that. An example to clarify what I mean:</p>

<figure class='code'><figcaption><span>Context/Specification When/Then</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">When_adding_a_contact_to_a_user_with_no_existing_contacts</span> <span class="p">{</span> <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>&#8220;Adding a contact&#8221; is the observed behavior in the context of &#8220;no existing contacts&#8221;. I believe this should be more obvious, which
made me thinking of how a syntax for this could look like. Having said that, here is what I came up with. It&#8217;s heavily inspired by MSpec and
<a href="http://dannorth.net/2007/06/introducing-rbehave">RBehave</a>.</p>

<figure class='code'><figcaption><span>Example for a new syntax</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[SpecificationFor(typeof(PatientService))]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">A_patient_with_a_missing_first_name_is_not_allowed_to_be_persisted</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">Given</span> <span class="n">a_patient_with_a_missing_first_name</span> <span class="p">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="p">};</span>
</span><span class='line'>  <span class="n">When</span> <span class="n">trying_to_save_the_patient</span> <span class="p">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="p">};</span>
</span><span class='line'>  <span class="n">It</span> <span class="n">should_not_persist_the_supplied_patient</span> <span class="p">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="p">};</span>
</span><span class='line'>  <span class="n">It</span> <span class="n">should_return_a_report_indicating_that_the_patients_first_name_is_required</span> <span class="p">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span> <span class="p">};</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>A generated report for this code might look like this:</p>

<h2>Specifications for &#8220;PatientService&#8221;</h2>

<ul>
<li>A patient with a missing first name is not allowed to be persisted

<ul>
<li>Given a patient transfer object with a missing first name</li>
<li>when trying to save the patient

<ul>
<li>it should not persist the supplied patient</li>
<li>it should return a report indicating that the patients first name is required</li>
</ul>
</li>
</ul>
</li>
</ul>


<p>I&#8217;m still not 100% happy with this, because there is some sort of duplication between the fixture name and the &#8220;givens&#8221; (at least in the
shown example), but with this approach you</p>

<ol>
<li>are able to separate context and behavior in a clean way,</li>
<li>can describe the context very fine grained (by having multiple
&#8220;givens&#8221;)</li>
<li>and besides that it looks cool ;-)</li>
</ol>


<p>I would like to hear opinions on that. Is this something worth implementing / adding to xUnit.BDDExtensions? Or am I off the track with this?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/20/command-query-separation/">Command Query Separation</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2008-11-20T03:08:16+01:00" pubdate  data-updated="true" >Nov 20<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Does this sound familiar to you? From time to time someone delivers you answers to questions that have been on your mind for quite a while. You
didn&#8217;t find an answer on your own and most of the people you talked with either didn&#8217;t care or hadn&#8217;t satisfying answers for you. When you
finally hear the answers you were searching for, you&#8217;re &#8230;</p>

<ol>
<li>stunned how simple the actual solution is,</li>
<li>wondering why you weren&#8217;t able to solve that on your own,</li>
<li>nevertheless happy and thankful to finally see the missing piece in
your puzzle.</li>
</ol>


<p>Today I had the luck to be able to talk with Gregory Young about (Distributed) Domain Driven Design in general and in particular some
about questions regarding bidirectional mapping from domain object to DataTransferObject, and how messaging or eventing integrates with DDD.
This is what I took from that discussion &#8230;</p>

<p><strong>At first there was the problem &#8230;</strong></p>

<p>It&#8217;s widely accepted and adopted that domain objects should not be used for displaying data in the UI. The UI should not
dictate the shape of your domain object, nor should it require the domain class to implement stuff (for instance <code>INotifiyPropertyChanged</code>).
Because of that, you introduce DataTransferObjects for displaying data in the UI. This is beneficial because all of a sudden you&#8217;re able to
have different views on the same domain object. Nearly the same applies for distributed scenarios. Tech-specific stuff like attributes for
serialization or the need for public getters and setters should not dictate the shape of your domain object. Again the answer is
DataTransferObject, because they protect the domain objects from infrastructure related needs. The situation becomes even more
interesting, when you want your domain model to have a more behavior oriented design, where behavior is best expressed through methods and
with less properties. Why should you do this? First you can protect the validity of your domain object far better with bundling changes that you
can make on it, in methods. With that you get rid of temporary invalid state in which all of the properties are set to correct values and live
in your domain model becomes easier in a lot of places (because you don&#8217;t have to check for validity everywhere). Second why should the data
be exposed anyway, if not for display or persistence? What about Data-encapsulation, anyone? So if you remove all the getter setter stuff
from domain objects, how do you do the mapping to a DTO without imposing some shape constraints on the domain object. ? And how do you do that
mapping without inventing the next hot reflection &amp; attribute based thing of the day? I know a lot of applications in which domain objects
and DTOs look exactly the same (with the only subtle difference that the domain object lacks some of the attributes or implemented interfaces of
the DTO) because of that problem. What is the benefit of this? For some systems with public APIs consumed by a third party this might make
sense, because it delivers the ability to develop the internal API separated from the public one. For the rest of all applications out
there it introduces reversibility and flexibility at the cost of the overhead for DTOs. This is very often hard to communicate, because the
benefit is not so obvious.</p>

<h2>&#8230; and then came the solution:</h2>

<p>You&#8217;ll have to separate write access to your domain from the read access which is exactly known as the Command Query Separation. I made
some sketches while listening to Greg talk, because I had to visualize this for myself. (They look awful, I know but having a picture to
describe something is better compared to having none . . ) Look at the following sketch. It tries to show the data flow trough an application
for a simple read-update-scenario.</p>

<p><a href="/images/posts/img-1750.jpg"><img src="/images/posts/img-1750-thumb.jpg" alt="IMG_1750" /></a></p>

<p>The interesting part is that the mapping from domain object to DTO is missing. The query side is fully based on DTOs. When the something is
changed a command is executed which performs the action on the domain model and persists the changes via the repositories. Looks like a
circle, doesn&#8217;t it? How is the situation when we have a read-update scenario a multi proc application, for instance classic client / server?
I tried to capture that too. Using the separation it doesn&#8217;t seem too hard to integrate.</p>

<p><a href="/images/posts/img-1754.jpg"><img src="/images/posts/img-1754-thumb.jpg" alt="IMG_1754" /></a></p>

<p>What&#8217;s new in the picture? MessageHandlers ! They can receive and send messages and serve as communication endpoints. Besides that the
presentation stays pretty much the same.</p>

<h2>Integrating change notifications to the model </h2>

<p>What is also very easy to integrate into this architecture are change notifications. The following sketch shows
only the command portion of the sketches above. The only thing we need
to do in order to do change notifications is to publish messages /
events into a message bus / event bus when we&#8217;ve changed something on
our domain objects.</p>

<p><a href="/images/posts/img-1754.jpg"><img src="/images/posts/img-1751.jpg" alt="IMG_1751" /></a></p>

<p>With that we can add change logging, tracking, monitoring in a very loosely coupled way (and that are only a few possibilities).</p>

<h2>Final thoughts</h2>

<p>Isn&#8217;t there a chapter in Eric Evans book called &#8220;Refactoring to deeper insight&#8221; ? That somehow describes how I currently feel. The
proposed solution is very flexible, supports poco domains which focus on behavior and protects that domain from infrastructure related stuff. I
do not claim it to be the solution, but it certainly is a valid solution to the problem. What I like about it in particular is how nicely it
integrates with my <a href="/2008/11/08/some-thoughts-about-validation-logic/">thoughts about validation logic</a> (domain validation is always in valid state, validation is done at the
domain edge).</p>

<p>Greg, if you&#8217;re reading this, thanks a lot for answering my questions that detailed (and excuse my wacky English skills :-)).
Meeting people like you justifies the whole traveling to San Francisco alone &#8230;</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2008/11/19/quote-of-the-day/">Quote of the Day</a></h1>
    
    
      <p class="meta">
        





  



<time datetime="2008-11-19T06:57:46+01:00" pubdate  data-updated="true" >Nov 19<span>th</span>, 2008</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Enjoy the following comment I&#8217;ve heard today in the Domain Specific Languages track:</p>

<blockquote><p><strong>&#8230; XML is data dressed up as a hooker &#8230;</strong></p></blockquote>
</div>
  
  


    </article>
  
  <nav class="pagination">
    <div>
      
        <a class="prev" href="/blog/page/7/">&larr; Older</a>
      
      <a href="/blog/archives">Blog Archives</a>
      
      <a class="next" href="/blog/page/5/">Newer &rarr;</a>
      
    </div>
  </nav>
</div>
<aside class="sidebar">
  
    <section>
	<h1>About me</h1>
  <p><br/><img src="/images/bjro-eyes.jpg" alt="portrait" /></p>
	<p>
  My name is <strong>Björn Rochel</strong>.  I&#8217;m a 32 year old geek, who&#8217;s crazy about software development, living in Cologne and
  currently working for <a href="http://www.intercomponentware.com">ICW</a> as a Developer / Architect.
	</p>
	<ul id="badges">
    <li><a id="xing" href="http://www.xing.com/profile/Bjoern_Rochel"><span>XING</span></a></li>
    <li><a id="github" href="http://www.github.com/BjRo"><span>Github</span></a></li>
    <li><a id="twitter" href="http://www.twitter.com/bjoernrochel"><span>Twitter</span></a></li>
    <li><a id="rss" href="/atom.xml"><span>Rss</span></a></li>
	</ul>
</section>

<section>
  <h1>Categories</h1>
  <ul id='categories'>
<li><a href='http://www.bjoernrochel.de/blog/categories/Conferences/'>Conferences (8)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/FSharp/'>FSharp (3)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/Katas/'>Katas (2)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/StoryTeller/'>StoryTeller (14)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/StructureMap/'>StructureMap (9)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/Testing/'>Testing (20)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/Uncategorized/'>Uncategorized (8)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/dotnet/'>dotnet (65)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/ruby/'>ruby (3)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/sw-design/'>sw-design (13)</a></li>
<li><a href='http://www.bjoernrochel.de/blog/categories/xUnitBDDExtensions/'>xUnitBDDExtensions (15)</a></li>
</ul>

</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("bjoernrochel", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/bjoernrochel" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @bjoernrochel</a>
  
</section>

<section>
<h1>Disclaimer</h1>
<p>
The opinions expressed herein are my own personal opinions and do not necessarily represent the opinion of any other organization or person, including (but not limited to) my fellow employees, my employer, its clients or their agents. 
</p>
<p>
 Copyright &copy; 2011 - Björn Rochel
</p>
<section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Björn Rochel -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'bjro';
      
        
        var disqus_script = 'count.js';
      

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>







</body>
</html>
