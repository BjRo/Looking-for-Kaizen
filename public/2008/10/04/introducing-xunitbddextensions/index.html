
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Introducing xUnit.BDDExtensions - Dude, where's my Kaizen?</title>
  <meta name="author" content="Björn Rochel">

  
  <meta name="description" content="xUnit.BDDExtensions is a little framework build on top of xUnit which enables a BDD style of testing with xUnit. Besides an emphasis on a&#8220;test &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.bjoernrochel.de/2008/10/04/introducing-xunitbddextensions/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Dude, where's my Kaizen?" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <header role="banner"><div id="logo">
	<img src="/images/kaizen.png" alt="Kaizen" title="Kaizen" />
</div>
<hgroup>
  <h1><a href="/">Dude, where's my Kaizen?</a></h1>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.bjoernrochel.de" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Introducing xUnit.BDDExtensions</h1>
    
    
      <p class="meta">
        





  



<time datetime="2008-10-04T13:28:31+02:00" pubdate  data-updated="true" >Oct 4<span>th</span>, 2008</time>
        
      </p>
    
  </header>


<div class="entry-content"><p><code>xUnit.BDDExtensions</code> is a little framework build on top of xUnit which enables a BDD style of testing with xUnit. Besides an emphasis on a
&#8220;test case class per fixture&#8221; organization scheme for tests, AAA (Arrange, Act and Assert) style of writing tests and left to right
assertions, this framework also provides Rhino.Mocks integration out of the box. By hiding the mechanics of Rhino.Mocks (record and replay
model, mocks vs. stubs) behind the scenes, xUnit.BDDExtensions also helps on writing cleaner, easier to understand and less brittle tests
xUnit.BDDExtensions is based on JP Boodhoos BDD extensions for MBUnit used in his &#8220;Nothing but .NET&#8221; bootcamps.</p>

<h2>Enough of the talking, let&#8217;s look at some code</h2>

<p>This is actual code of the xUnit.BDDExtensions trunk. The <code>SpecificationTestCommand</code> class serves as a kind of adapter inside
xUnit. It enables the test class to have methods that are run before and after the actual test method is executed.</p>

<figure class='code'><figcaption><span>The guts of xUnit.BDDExtensions </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">SpecificationTestCommand</span> <span class="p">:</span> <span class="n">BeforeAfterCommand</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="nf">SpecificationTestCommand</span><span class="p">(</span><span class="n">ITestCommand</span> <span class="n">innerCommand</span><span class="p">,</span> <span class="n">MethodInfo</span> <span class="n">testMethod</span><span class="p">)</span> <span class="p">:</span> <span class="k">base</span><span class="p">(</span><span class="n">innerCommand</span><span class="p">,</span> <span class="n">testMethod</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">public</span> <span class="k">override</span> <span class="n">MethodResult</span> <span class="nf">Execute</span><span class="p">(</span><span class="kt">object</span> <span class="n">testClass</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">var</span> <span class="n">specification</span> <span class="p">=</span> <span class="n">testClass</span> <span class="k">as</span> <span class="n">ITestSpecification</span><span class="p">;</span>
</span><span class='line'>      
</span><span class='line'>      <span class="k">try</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="n">specification</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="k">throw</span> <span class="k">new</span> <span class="nf">InvalidOperationException</span><span class="p">(</span> <span class="s">&quot;Instance does not implement ITestSpecification&quot;</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          
</span><span class='line'>          <span class="n">specification</span><span class="p">.</span><span class="n">InitializeSpecification</span><span class="p">();</span>
</span><span class='line'>          <span class="k">return</span> <span class="k">base</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">testClass</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">finally</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="n">specification</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="n">specification</span><span class="p">.</span><span class="n">CleanupSpecification</span><span class="p">();</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice several things:</p>

<ol>
<li>It expects the instance to implement <code>ITestSpecification</code>.</li>
<li>It calls the <code>InitializeSpecification()</code> method on it</li>
<li>Passes the execution to the inner command (in <code>base.Execute(obj)</code>)</li>
<li>and finally cleans up the specification by calling
<code>CleanupSpecification()</code> on it.</li>
</ol>


<p>So how can a completely isolated happy path test for this look like?</p>

<figure class='code'><figcaption><span>A happy path specification</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="na">[Concern(typeof(SpecificationTestCommand))]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">when_a_specification_test_command_is_executed_on_a_ITestSpecification_implementer</span> <span class="p">:</span> <span class="n">concern_for_specification_test_command</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">MethodResult</span> <span class="n">expectedTestResult</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">ITestCommand</span> <span class="n">innerCommand</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">MethodInfo</span> <span class="n">methodInfo</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">MethodResult</span> <span class="n">testResult</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">ITestSpecification</span> <span class="n">testSpecification</span><span class="p">;</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">EstablishContext</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">innerCommand</span> <span class="p">=</span> <span class="n">Dependency</span><span class="p">&lt;</span><span class="n">ITestCommand</span><span class="p">&gt;();</span>
</span><span class='line'>      <span class="n">testSpecification</span> <span class="p">=</span> <span class="n">Dependency</span><span class="p">&lt;</span><span class="n">ITestSpecification</span><span class="p">&gt;();</span>
</span><span class='line'>      <span class="n">methodInfo</span> <span class="p">=</span> <span class="n">GetTestMethodHandle</span><span class="p">();</span>
</span><span class='line'>      <span class="n">expectedTestResult</span> <span class="p">=</span> <span class="n">CreateMethodResult</span><span class="p">(</span><span class="n">methodInfo</span><span class="p">);</span>
</span><span class='line'>      <span class="n">innerCommand</span><span class="p">.</span><span class="n">WhenToldTo</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">testSpecification</span><span class="p">)).</span><span class="n">Return</span><span class="p">(</span><span class="n">expectedTestResult</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="n">SpecificationTestCommand</span> <span class="nf">CreateSut</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">SpecificationTestCommand</span><span class="p">(</span><span class="n">innerCommand</span><span class="p">,</span> <span class="n">methodInfo</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">Because</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">testResult</span> <span class="p">=</span> <span class="n">Sut</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">testSpecification</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Observation]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">should_ask_the_test_specification_to_initialize</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">testSpecification</span><span class="p">.</span><span class="n">WasToldTo</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">InitializeSpecification</span><span class="p">());</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na"> [Observation]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">should_pass_the_test_specification_to_the_inner_test_command</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">innerCommand</span><span class="p">.</span><span class="n">WasToldTo</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Execute</span><span class="p">(</span><span class="n">testSpecification</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> [Observation]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">should_return_the_test_result_from_the_inner_test_command</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">testResult</span><span class="p">.</span><span class="n">ShouldBeEqualTo</span><span class="p">(</span><span class="n">expectedTestResult</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="na"> </span>
</span><span class='line'><span class="na"> [Observation]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">should_ask_the_test_specification_to_cleanup</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">testSpecification</span><span class="p">.</span><span class="n">WasToldTo</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">CleanupSpecification</span><span class="p">());</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Notice several things:</p>

<ol>
<li>In the <code>EstablishContext()</code> method the whole context for the test is
created. This includes creating most of the dependencies with
Rhino.Mocks through <code>Dependeny()</code> and the necessary configuration of
their behavior. This is done in order to quickly get from an
interaction based style of testing to a state based style of
testing. In AAA terms this method implements the Arrange part.</li>
<li>The <code>CreateSut()</code> method is executed after <code>EstablishContext()</code> and
creates the actual system under test.</li>
<li>The <code>Because()</code> method implements the actual behavior under test. In
AAA terms this is the Act part. In the current example this meant
executing the test command with an instance implementing the
expected interface.</li>
<li>Each method marked with the <code>ObservationAttribute</code> contains a single
observation which should be fulfilled when the test has been
executed. In AAA terms every Observation is an Assert.</li>
</ol>


<p>That&#8217;s basically it. Pretty straight forward imho. If I managed to make
you at least a bit curious about this style of testing, you can grab the
source with any git client from: <a href="http://github.com/bjro/xunitbddextensions">http://github.com/bjro/xunitbddextensions</a></p>

<p>Enjoy coding</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">BjRo</span></span>

      





  



<time datetime="2008-10-04T13:28:31+02:00" pubdate  data-updated="true" >Oct 4<span>th</span>, 2008</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/testing/'>Testing</a>, <a class='category' href='/blog/categories/dotnet/'>dotnet</a>, <a class='category' href='/blog/categories/xunitbddextensions/'>xUnitBDDExtensions</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.bjoernrochel.de/2008/10/04/introducing-xunitbddextensions/" data-via="bjoernrochel" data-counturl="http://www.bjoernrochel.de/2008/10/04/introducing-xunitbddextensions/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
</div>

    
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
	<h1>About me</h1>
  <p><br/><img src="/images/bjro-eyes.jpg" alt="portrait" /></p>
	<p>
  My name is <strong>Björn Rochel</strong>.  I'm a 32 year old geek, who's crazy about software development, living in Cologne and
  currently working for <a href="http://www.intercomponentware.com">ICW</a> as a .NET Developer / Architect.
	</p>
	<ul class="badges">
		<li><a href="http://www.xing.com/profile/Bjoern_Rochel"><img src="/images/badges/xing2-small.png" alt="Xing" /></a></li>
		<li><a href="http://www.github.com/BjRo"><img src="/images/badges/github-small.png" alt="Github" /></a></li>
		<li><a href="http://www.twitter.com/bjoernrochel"><img src="/images/badges/twitter-square-small.png" alt="Twitter" /></a></li>
		<li><a href="/atom.xml"><img src="/images/badges/rss-circle-small.png" alt="Rss" /></a></li>
	</ul>
</section>

<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/Conferences/'>Conferences (8)</a></li>
<li class='category'><a href='/blog/categories/FSharp/'>FSharp (3)</a></li>
<li class='category'><a href='/blog/categories/Katas/'>Katas (2)</a></li>
<li class='category'><a href='/blog/categories/StoryTeller/'>StoryTeller (14)</a></li>
<li class='category'><a href='/blog/categories/StructureMap/'>StructureMap (9)</a></li>
<li class='category'><a href='/blog/categories/Testing/'>Testing (20)</a></li>
<li class='category'><a href='/blog/categories/Uncategorized/'>Uncategorized (7)</a></li>
<li class='category'><a href='/blog/categories/dotnet/'>dotnet (65)</a></li>
<li class='category'><a href='/blog/categories/ruby/'>ruby (3)</a></li>
<li class='category'><a href='/blog/categories/sw-design/'>sw-design (13)</a></li>
<li class='category'><a href='/blog/categories/xUnitBDDExtensions/'>xUnitBDDExtensions (15)</a></li>

  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("bjoernrochel", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/bjoernrochel" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @bjoernrochel</a>
  
</section>

<section>
<h1>Disclaimer</h1>
<p>
The opinions expressed herein are my own personal opinions and do not necessarily represent the opinion of any other organization or person, including (but not limited to) my fellow employees, my employer, its clients or their agents. 
</p>
<p>
 Copyright &copy; 2011 - Björn Rochel
</p>
<section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - Björn Rochel -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'bjro';
      
        

				//TODO: comment disqus_developer out
				var disqus_developer = 1;
				var disqus_identifier = 'http://www.bjoernrochel.de/2008/10/04/introducing-xunitbddextensions/';
				var disqus_url = 'http://www.bjoernrochel.de/2008/10/04/introducing-xunitbddextensions/';
        var disqus_script = 'embed.js';
      

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>







</body>
</html>
