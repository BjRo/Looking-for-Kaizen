
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Some thoughts about validation logic - Dude, where's my Kaizen?</title>
  <meta name="author" content="BjÃ¶rn Rochel">

  
  <meta name="description" content="The design of validation in software is one of those strange topics youcan discuss endlessly about. Some of the major questions concerningvalidation: &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.bjoernrochel.de/2008/11/08/some-thoughts-about-validation-logic/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Dude, where's my Kaizen?" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

</head>

<body   >
  <header role="banner"><div id="logo">
	<img src="/images/kaizen.png" alt="Kaizen" title="Kaizen" />
</div>
<hgroup>
  <h1><a href="/">Dude, where's my Kaizen?</a></h1>
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:www.bjoernrochel.de" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Some Thoughts About Validation Logic</h1>
    
    
      <p class="meta">
        





  



<time datetime="2008-11-08T12:16:31+01:00" pubdate  data-updated="true" >Nov 8<span>th</span>, 2008</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>The design of validation in software is one of those strange topics you
can discuss endlessly about. Some of the major questions concerning
validation:</p>

<ol>
<li>In which Layer should validation logic reside? Is it part of the Domain Layer, part of the Presentation Layer, or is it somehow part
of both?</li>
<li>Who is responsible for validation? Should the subject of the validation have the responsibility to validate itself or is that
responsibility worth to be separated from the subject?)</li>
<li>How should validation results be transferred to the caller? By throwing an exception, or by returning a sequence of validation
results?</li>
<li>How should a validation results be represented? As plain strings, or with the notification pattern?</li>
</ol>


<p>I would like to discuss my point of view regarding those questions. I don&#8217;t claim my conclusions to be best-practices or something like that.
They are just my latest thoughts on that topic. Going from top to bottom, here is what I would currently respond to those questions:</p>

<h2>In which layer should validation logic reside?</h2>

<p>I think it&#8217;s easier to answer this question with saying where it primarily should not be: In the Presentation Layer. Validation contains business know how. Therefore it should reside in some lower or inner layer in my opinion. Which layer
actually should contain the validation logic depends on the actual design of your application. When following a data centric approach, I
think it&#8217;s best to put the validation logic in the business layer which consumes your Data Transfer Objects. As I said: I strongly believe that
validation logic is business know how. When using a more Domain Driven Design approach things get a little more difficult. A good place for
validation logic definitely is the domain layer. However one hot topic on the Alt.NET mailing list in the past months was whether domain
objects should be able to have an invalid state or not. This decision has naturally very strong implications on validation. Why should you
have validation in the domain layer when every domain object is by its nature in a valid state after its construction and can never be invalid?
So if it&#8217;s not in the domain where is it then? I would propose to put it on the surrounding / higher layer, the Service Layer. The Service Layer
very often uses Data Transfer Objects in order to communicate with higher level callers. This is mostly done to protect your domain design
from invasive infrastructure related stuff, for instance things you need to implement in order to support databinding or correct serialization.
The service layer as I see it is in that case responsible for converting DTOs to domain objects and calling some lower level functionality with
them. This is a good place for integrating validation based on the incoming DTOs and currently my favourite place for validation. Here is a
simple sequence diagram to give you an idea about the interactions that would happen inside such a layer.</p>

<p><a href="/images/posts/servicelayer.png"><img src="/images/posts/servicelayer-300x67.png" alt="image" /></a></p>

<h2>Who is responsible for the validation?</h2>

<p>You might (or might not) have recognized it in the sequence diagram above: I&#8217;m not a fan of having validation logic inside the actual validation subject. For simple static
validations (like not null, string length, format) it would be sufficient to bake validation logic into the subject. When it comes to
more real world scenarios I believe it&#8217;s a good idea to separate the validation from the subject. Why? For instance because of dependency
management and Open Closed Principle. A simple example: You have a business object which contains a German zip code. The range of possible
values for this is pretty high. This is something that probably would be validated against some sort of catalogue. Should the business object
know or event care about the catalogue? I believe it should not. Besides that having external validation enables you to have context related
validation on a subject (Maybe some Service Layer operations need more mandatory information than others &#8230; ) The business entity doesn&#8217;t
need to be altered to support this. Jeremy Miller once said that every Client-App should have an <code>IPresenter</code> interface. In the same way I would
argue that every application dealing with the need to validate inputs should contain an <code>IValidator</code> interface.</p>

<h2>How to transfer validation errors to the caller?</h2>

<p>How do most of the .NET framework classes handle validation? They throw strong typed exceptions on invalid input.  Expressing validation errors through exceptions therefore seems
consistent for me with the rest of the framework. This also implicates that a method signature of a higher level caller (f.e. a Service Layer method) is not polluted with validation specific stuff (because the
exception can bubble up), which I would also consider a good thing. An <code>IValidator</code> interface resulting from this conclusion might look like
this:</p>

<figure class='code'><figcaption><span>A basic validator interface</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">interface</span> <span class="n">IValidator</span><span class="p">&lt;</span><span class="n">Subject</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">void</span> <span class="nf">Validate</span><span class="p">(</span><span class="n">Subject</span> <span class="n">subject</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>However, you might want to return validation results (like warnings for instance) but leave the decision whether to continue execution to the caller. In that case</p>

<figure class='code'><figcaption><span>A validator with notifications</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">interface</span> <span class="n">IValidator</span><span class="p">&lt;</span><span class="n">Subject</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Notification</span><span class="p">&gt;</span> <span class="n">Validate</span><span class="p">(</span><span class="n">Subject</span> <span class="n">subject</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>might also be a valid alternative.</p>

<h2>How should validation results be represented?</h2>

<p>I would prefer using the Notification Pattern for transferring validation results rather than using plain strings for that Why?</p>

<ol>
<li>A validation result can be much more than a simple message. It could contain other helpful information like a globally unique error code
for instance in addition to just the plain message.</li>
<li>In some cases you might want to differentiate between different classes of validation information, for instance between warnings and errors.</li>
<li>It introduces the different types of validation information as a real concept to your application. It&#8217;s more explicit.</li>
<li>It frees the validation logic from having to deal with the validation messages itself. The messages can be changed without
affecting the actual validation logic.</li>
</ol>


<p>The notification pattern is pretty trivial. It consists of a base class
for notifications</p>

<figure class='code'><figcaption><span>A possible implementation for the Notification pattern</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Notification</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="kt">string</span> <span class="n">Message</span> <span class="p">{</span><span class="k">get</span><span class="p">;</span> <span class="k">protected</span> <span class="k">set</span><span class="p">;}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and one or more derivates of it, representing generic errors or warnings.</p>

<figure class='code'><figcaption><span>An error notification</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">Error</span> <span class="p">:</span> <span class="n">Notification</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="nf">Error</span> <span class="p">(</span><span class="kt">string</span> <span class="n">message</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">Message</span> <span class="p">=</span> <span class="n">message</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you combine that with some kind of pseudo enumerations like this</p>

<figure class='code'><figcaption><span>a pseudo enumeration containing all error notifications</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">CustomerErrors</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">Error</span> <span class="n">FirstNameIsMissing</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Error</span><span class="p">(</span><span class="s">&quot;The first name is missing&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">Error</span> <span class="n">FirstNameIsMissing</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Error</span><span class="p">(</span><span class="s">&quot;The first name is missing&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">Error</span> <span class="n">LastNameIsMissing</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Error</span><span class="p">(</span><span class="s">&quot;The last name is missing&quot;</span><span class="p">);</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">static</span> <span class="n">Error</span> <span class="nf">InvalidEmail</span><span class="p">(</span><span class="kt">string</span> <span class="n">emailAddress</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="k">new</span> <span class="nf">Error</span><span class="p">(</span> <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;The email &#39;{0}&#39; is invalid&quot;</span><span class="p">,</span> <span class="n">emailAddress</span><span class="p">));</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>you&#8217;re able to get pretty expressive with validation logic.</p>

<h2>Whats missing? Yeah right, the actual validation &#8230;</h2>

<p>I&#8217;ve written a little fluent API which helps me in writing concrete validators in a very declarative way. The whole thing
is probably worth a post on its own so I won&#8217;t go into detail so much here and save a general discussion of the implementation for the next
post. So just a sneak preview here :-).</p>

<figure class='code'><figcaption><span>A custom validator </span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='csharp'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">CustomerDtoValidator</span> <span class="p">:</span> <span class="n">Validator</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">public</span> <span class="nf">CustomerDtoValidator</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>      <span class="n">If</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">FirstName</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">()).</span><span class="n">AddNotification</span><span class="p">(</span><span class="n">CustomerErrors</span><span class="p">.</span><span class="n">FirstNameIsMissing</span><span class="p">)</span>
</span><span class='line'>      <span class="n">If</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">LastName</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">()).</span><span class="n">AddNotification</span><span class="p">(</span><span class="n">CustomerErrors</span><span class="p">.</span><span class="n">LastNameIsMissing</span><span class="p">)</span>
</span><span class='line'>      <span class="n">If</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">EmailAddress</span><span class="p">.</span><span class="n">IsNullOrEmpty</span><span class="p">()).</span><span class="n">AddNotification</span><span class="p">(</span><span class="n">CustomerErrors</span><span class="p">.</span><span class="n">EmailAddressIsMissing</span><span class="p">)</span>
</span><span class='line'>      <span class="n">If</span><span class="p">(</span><span class="k">new</span> <span class="n">EmailAddressSpecification</span><span class="p">()).</span><span class="n">AddNotification</span><span class="p">(</span><span class="n">CustomerErrors</span><span class="p">.</span><span class="n">EmailAddressIsInvalid</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Neat isn&#8217;t it? What you see here is actually very simple.  The If-AddNotification statement consists of the specification pattern (as a real specification instance or in a more functional inlined lamda
version) and a second part that returns a notification. This second part is only executed when the specification part is satisfied. All together they form a chain of actions which are executed on a supplied subject.</p>

<h2>Stuff not mentioned in this post</h2>

<p>There are still a lot of things I did not cover in this post. A very obvious one is the topic of how to map the notifications received from such a validation to controls in the presentation layer. Besides that a bit of AOP or MDSD Code Generation
would also help to streamline the integration of this concepts. I&#8217;ll try to come back to the topic of validation soon. I would be happy to hear
some sort of feedback on this. So, feel free to comment, bash, whatsoever &#8230;</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">BjRo</span></span>

      





  



<time datetime="2008-11-08T12:16:31+01:00" pubdate  data-updated="true" >Nov 8<span>th</span>, 2008</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/dotnet/'>dotnet</a>, <a class='category' href='/blog/categories/sw-design/'>sw-design</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.bjoernrochel.de/2008/11/08/some-thoughts-about-validation-logic/" data-via="bjoernrochel" data-counturl="http://www.bjoernrochel.de/2008/11/08/some-thoughts-about-validation-logic/" >Tweet</a>
  
  
  <div class="g-plusone" data-size="medium"></div>
  
</div>

    
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
	<h1>About me</h1>
  <p><br/><img src="/images/bjro-eyes.jpg" alt="portrait" /></p>
	<p>
  My name is <strong>BjÃ¶rn Rochel</strong>.  I'm a 32 year old geek, who's crazy about software development, living in Cologne and
  currently working for <a href="http://www.intercomponentware.com">ICW</a> as a Developer / Architect.
	</p>
	<ul class="badges">
		<li><a href="http://www.xing.com/profile/Bjoern_Rochel"><img src="/images/badges/xing2-small.png" alt="Xing" /></a></li>
		<li><a href="http://www.github.com/BjRo"><img src="/images/badges/github-small.png" alt="Github" /></a></li>
		<li><a href="http://www.twitter.com/bjoernrochel"><img src="/images/badges/twitter-square-small.png" alt="Twitter" /></a></li>
		<li><a href="/atom.xml"><img src="/images/badges/rss-circle-small.png" alt="Rss" /></a></li>
	</ul>
</section>

<section>
  <h1>Categories</h1>
  <ul id="categories">
    <li class='category'><a href='/blog/categories/Conferences/'>Conferences (8)</a></li>
<li class='category'><a href='/blog/categories/FSharp/'>FSharp (3)</a></li>
<li class='category'><a href='/blog/categories/Katas/'>Katas (2)</a></li>
<li class='category'><a href='/blog/categories/StoryTeller/'>StoryTeller (14)</a></li>
<li class='category'><a href='/blog/categories/StructureMap/'>StructureMap (9)</a></li>
<li class='category'><a href='/blog/categories/Testing/'>Testing (20)</a></li>
<li class='category'><a href='/blog/categories/Uncategorized/'>Uncategorized (8)</a></li>
<li class='category'><a href='/blog/categories/dotnet/'>dotnet (65)</a></li>
<li class='category'><a href='/blog/categories/ruby/'>ruby (3)</a></li>
<li class='category'><a href='/blog/categories/sw-design/'>sw-design (13)</a></li>
<li class='category'><a href='/blog/categories/xUnitBDDExtensions/'>xUnitBDDExtensions (15)</a></li>

  </ul>
</section>

<section>
  <h1>Latest Tweets</h1>
  <ul id="tweets">
    <li class="loading">Status updating...</li>
  </ul>
  <script type="text/javascript">
    $.domReady(function(){
      getTwitterFeed("bjoernrochel", 4, false);
    });
  </script>
  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/bjoernrochel" class="twitter-follow-button" data-width="208px" data-show-count="false">Follow @bjoernrochel</a>
  
</section>

<section>
<h1>Disclaimer</h1>
<p>
The opinions expressed herein are my own personal opinions and do not necessarily represent the opinion of any other organization or person, including (but not limited to) my fellow employees, my employer, its clients or their agents. 
</p>
<p>
 Copyright &copy; 2011 - BjÃ¶rn Rochel
</p>
<section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2011 - BjÃ¶rn Rochel -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'bjro';
      
        

				//var disqus_developer = 1;
				var disqus_identifier = 'http://www.bjoernrochel.de/2008/11/08/some-thoughts-about-validation-logic/';
				var disqus_url = 'http://www.bjoernrochel.de/2008/11/08/some-thoughts-about-validation-logic/';
        var disqus_script = 'embed.js';
      

    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>







</body>
</html>
